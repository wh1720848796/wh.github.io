<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SQL开发 | 饮茶</title><meta name="author" content="Yincha"><meta name="copyright" content="Yincha"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="SQL开发 第1章：SQL概述SQL：Structured Query Language结构化查询语言，它是使用关系模型的数据库应用语言，由IBM上世纪70年代开发出来。后由美国国家标准局（ANSI）开始着手制定SQL标准，先后有SQL-86，SQL-89，SQL-92，SQL-99等标准。 1. SQL的语言规范 mysql对于SQL语句不区分大小写，SQL语句关键字尽量大写 SQL 可以写在一">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL开发">
<meta property="og:url" content="http://wh1720848796.github.io/post/5d2c694a.html">
<meta property="og:site_name" content="饮茶">
<meta property="og:description" content="SQL开发 第1章：SQL概述SQL：Structured Query Language结构化查询语言，它是使用关系模型的数据库应用语言，由IBM上世纪70年代开发出来。后由美国国家标准局（ANSI）开始着手制定SQL标准，先后有SQL-86，SQL-89，SQL-92，SQL-99等标准。 1. SQL的语言规范 mysql对于SQL语句不区分大小写，SQL语句关键字尽量大写 SQL 可以写在一">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://wh1720848796.github.io/img/HatsuneMiku6.png">
<meta property="article:published_time" content="2023-05-10T09:12:46.000Z">
<meta property="article:modified_time" content="2023-05-10T09:17:13.695Z">
<meta property="article:author" content="Yincha">
<meta property="article:tag" content="复习SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://wh1720848796.github.io/img/HatsuneMiku6.png"><link rel="shortcut icon" href="/img/EmiyaShirou.png"><link rel="canonical" href="http://wh1720848796.github.io/post/5d2c694a.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"NRN3QGVHM9","apiKey":"69a66e43b5218453c7420d0e818ebed9","indexName":"wh-code","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SQL开发',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-10 17:17:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/EmiyaShirou.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/HatsuneMiku6.png')"><nav id="nav"><span id="blog-info"><a href="/" title="饮茶"><span class="site-name">饮茶</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SQL开发</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-10T09:12:46.000Z" title="发表于 2023-05-10 17:12:46">2023-05-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-05-10T09:17:13.695Z" title="更新于 2023-05-10 17:17:13">2023-05-10</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span id="" data-flag-title="SQL开发"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SQL开发"><a href="#SQL开发" class="headerlink" title="SQL开发"></a>SQL开发</h1><hr>
<h2 id="第1章：SQL概述"><a href="#第1章：SQL概述" class="headerlink" title="第1章：SQL概述"></a>第1章：SQL概述</h2><p>SQL：Structured Query Language结构化查询语言，它是使用关系模型的数据库应用语言，由IBM上世纪70年代开发出来。后由美国国家标准局（ANSI）开始着手制定SQL标准，先后有SQL-86，SQL-89，SQL-92，SQL-99等标准。</p>
<h3 id="1-SQL的语言规范"><a href="#1-SQL的语言规范" class="headerlink" title="1. SQL的语言规范"></a>1. SQL的语言规范</h3><ul>
<li>mysql对于SQL语句不区分大小写，SQL语句关键字尽量大写</li>
<li>SQL 可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进</li>
<li>关键字不能被缩写也不能分行</li>
<li>值，除了数值型，<strong>字符串型和日期时间类型使用单引号（’ ‘）</strong></li>
<li>别名，尽量使用双引号（” “），而且不建议省略as</li>
<li>所有标点符号使用英文状态下的半角输入方式</li>
<li>必须保证所有(),单引号，双引号是成对结束的</li>
<li>可以使用（1）#单行注释 （2）–空格单行注释 （3）/*  多行注释  */</li>
</ul>
<h3 id="2-命名规则"><a href="#2-命名规则" class="headerlink" title="2. 命名规则"></a>2. 命名规则</h3><ul>
<li>数据库、表名不得超过30个字符，变量名限制为29个</li>
<li>必须只能包含 A–Z, a–z, 0–9, _共63个字符</li>
<li>不能在对象名的字符间留空格</li>
<li>必须不能和用户定义的其他对象重名</li>
<li>必须保证你的字段没有和保留字、数据库系统或常用方法冲突</li>
<li>保持字段名和类型的一致性,在命名字段并为其指定数据类型的时候一定要保证一致性。假如数据类型在一个表里是整数,那在另一个表里可就别变成字符型了</li>
<li>在命令行中的要求：</li>
</ul>
<p><img src="/post/5d2c694a/1554944183905.png" alt="1554944183905">         </p>
<blockquote>
<p>说明：一个语句可以分开多行编写，以;或\g结束</p>
</blockquote>
<h3 id="3-SQL分类"><a href="#3-SQL分类" class="headerlink" title="3. SQL分类"></a>3. SQL分类</h3><ul>
<li><p><strong>DDL（Data Definition Languages)：数据定义语言</strong>，这些语句定义了不同的数据段、数据库、表、列、索引等数据库对象。</p>
<ul>
<li>主要的语句关键字包括<code>CREATE</code>、<code>DROP</code>、<code>ALTER</code>等。</li>
</ul>
</li>
<li><p><strong>DML（Data Manipulation Language）：数据操作语言</strong>，用于添加、删除、更新和查询数据库记录，并检查数据完整性。</p>
<ul>
<li>主要的语句关键字包括<code>INSERT</code>、<code>DELETE</code>、<code>UPDATE</code>、<code>SELECT</code>等。</li>
<li><strong>SELECT是SQL语言的基础，最为重要。</strong></li>
</ul>
</li>
<li><p><strong>DCL（Data Control Language）：数据控制语言</strong>，用于控制不同数据段直接的许可和访问级别的语句。这些语句定义了数据库、表、字段、用户的访问权限和安全级别。</p>
<ul>
<li>主要的语句关键字包括<code>GRANT</code>、<code>REVOKE</code>、<code>COMMIT</code>、<code>ROLLBACK</code>、<code>SAVEPOINT</code>等。</li>
</ul>
</li>
</ul>
<hr>
<h2 id="第2章：数据处理之查询"><a href="#第2章：数据处理之查询" class="headerlink" title="第2章：数据处理之查询"></a>第2章：数据处理之查询</h2><h3 id="2-1-基本的SELECT语句"><a href="#2-1-基本的SELECT语句" class="headerlink" title="2.1 基本的SELECT语句"></a>2.1 基本的SELECT语句</h3><h4 id="2-1-1-SELECT-…-FROM"><a href="#2-1-1-SELECT-…-FROM" class="headerlink" title="2.1.1 SELECT … FROM"></a>2.1.1 SELECT … FROM</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   标识选择哪些列</span><br><span class="line"><span class="keyword">FROM</span>     标识从哪个表中选择</span><br></pre></td></tr></table></figure>

<ul>
<li>选择全部列：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>   departments;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554950890895.png" alt="1554950890895"></p>
<p><img src="/post/5d2c694a/1554950903518.png" alt="1554950903518"></p>
<ul>
<li>选择特定的列：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, location_id</span><br><span class="line"><span class="keyword">FROM</span>   departments;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554950947969.png" alt="1554950947969"></p>
<p><img src="/post/5d2c694a/1554950953272.png" alt="1554950953272"></p>
<h4 id="2-1-2-列的别名"><a href="#2-1-2-列的别名" class="headerlink" title="2.1.2 列的别名"></a>2.1.2 列的别名</h4><ul>
<li><p>重命名一个列</p>
</li>
<li><p>便于计算</p>
</li>
<li><p>紧跟列名，也可以<strong>在列名和别名之间加入关键字AS，别名使用双引号</strong>，以便在别名中包含空格或特殊的字符并区分大小写。</p>
</li>
</ul>
<p>使用别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">AS</span> name, commission_pct comm</span><br><span class="line"><span class="keyword">FROM</span>   employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554951616598.png" alt="1554951616598"></p>
<p><img src="/post/5d2c694a/1554951622467.png" alt="1554951622467"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name &quot;Name&quot;, salary<span class="operator">*</span><span class="number">12</span> &quot;Annual Salary&quot;</span><br><span class="line"><span class="keyword">FROM</span>   employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554951648377.png" alt="1554951648377"></p>
<p><img src="/post/5d2c694a/1554951655368.png" alt="1554951655368"></p>
<h4 id="2-1-3-去除重复行"><a href="#2-1-3-去除重复行" class="headerlink" title="2.1.3 去除重复行"></a>2.1.3 去除重复行</h4><p>默认情况下，查询会返回全部行，包括重复行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span>   employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554951711115.png" alt="1554951711115"></p>
<p><img src="/post/5d2c694a/1554951715923.png" alt="1554951715923"></p>
<p><strong>在SELECT语句中使用关键字DISTINCT去除重复行。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> department_id</span><br><span class="line"><span class="keyword">FROM</span>   employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554951796570.png" alt="1554951796570"></p>
<p><img src="/post/5d2c694a/1554951801044.png" alt="1554951801044"></p>
<h4 id="2-1-4-空值参与运算"><a href="#2-1-4-空值参与运算" class="headerlink" title="2.1.4 空值参与运算"></a>2.1.4 空值参与运算</h4><ul>
<li>所有运算符或列值遇到null值，运算的结果都为null</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,salary,commission_pct,</span><br><span class="line"><span class="number">12</span> <span class="operator">*</span> salary <span class="operator">*</span> (<span class="number">1</span> <span class="operator">+</span> commission_pct) &quot;annual_sal&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>



<h4 id="2-1-5-显示表结构"><a href="#2-1-5-显示表结构" class="headerlink" title="2.1.5 显示表结构"></a>2.1.5 显示表结构</h4><p>使用DESCRIBE 或 DESC 命令，表示表结构。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554951856201.png" alt="1554951856201"></p>
<h3 id="2-2-过滤数据"><a href="#2-2-过滤数据" class="headerlink" title="2.2 过滤数据"></a>2.2 过滤数据</h3><h4 id="2-2-1-SELECT-…-FROM-…-WHERE"><a href="#2-2-1-SELECT-…-FROM-…-WHERE" class="headerlink" title="2.2.1 SELECT … FROM … WHERE"></a>2.2.1 SELECT … FROM … WHERE</h4><p>背景：</p>
<p><img src="/post/5d2c694a/1554952199742.png" alt="1554952199742"></p>
<ul>
<li>使用WHERE 子句，将不满足条件的行过滤掉</li>
<li><strong>WHERE子句紧随 FROM子句</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  department_id <span class="operator">=</span> <span class="number">90</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554952277028.png" alt="1554952277028"></p>
<h4 id="2-2-2-比较运算符"><a href="#2-2-2-比较运算符" class="headerlink" title="2.2.2 比较运算符"></a>2.2.2 比较运算符</h4><h5 id="①-基本操作符"><a href="#①-基本操作符" class="headerlink" title="① 基本操作符"></a>① 基本操作符</h5><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>等于(不是==)</td>
</tr>
<tr>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td>&gt;=</td>
<td>大于、等于</td>
</tr>
<tr>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td>&lt;=</td>
<td>小于、等于</td>
</tr>
<tr>
<td>&lt;&gt;  或 !=</td>
<td>不等于</td>
</tr>
</tbody></table>
<blockquote>
<p>说明：赋值符号使用 :=</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">&lt;=</span> <span class="number">3000</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554970744610.png" alt="1554970744610"></p>
<h5 id="②-其它比较运算符"><a href="#②-其它比较运算符" class="headerlink" title="② 其它比较运算符"></a>② 其它比较运算符</h5><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>BETWEEN … AND</td>
<td>在两个值之间(包含边界)</td>
</tr>
<tr>
<td>IN(set)</td>
<td>等于值列表中的一个</td>
</tr>
<tr>
<td>LIKE</td>
<td>模糊查询</td>
</tr>
<tr>
<td>IS NULL</td>
<td>空值</td>
</tr>
</tbody></table>
<p><strong>1）BETWEEN … AND</strong></p>
<p>使用 BETWEEN 运算来显示在一个区间内的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="keyword">BETWEEN</span> <span class="number">2500</span> <span class="keyword">AND</span> <span class="number">3500</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554970965194.png" alt="1554970965194"></p>
<p><strong>2）IN</strong></p>
<p>使用 IN运算显示列表中的值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary, manager_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  manager_id <span class="keyword">IN</span> (<span class="number">100</span>, <span class="number">101</span>, <span class="number">201</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554973452273.png" alt="1554973452273"></p>
<p><img src="/post/5d2c694a/1554973455598.png" alt="1554973455598"></p>
<p><strong>3）LIKE</strong></p>
<ul>
<li><p>使用 LIKE 运算选择类似的值</p>
</li>
<li><p>选择条件可以包含字符或数字:</p>
<ul>
<li><strong>%</strong> **代表零个或多个字符(任意个字符)**。</li>
<li><strong>_</strong> <strong>代表一个字符</strong>。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	first_name</span><br><span class="line"><span class="keyword">FROM</span> 	employees</span><br><span class="line"><span class="keyword">WHERE</span>	first_name <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>‘%’和‘_’可以同时使用。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  last_name <span class="keyword">LIKE</span> <span class="string">&#x27;_o%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554973588723.png" alt="1554973588723"></p>
<p><strong>ESCAPE</strong></p>
<ul>
<li>回避特殊符号的：<strong>使用转义符</strong>。例如：将[%]转为[$%]、[]转为[$]，然后再加上[ESCAPE‘$’]即可。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span>   jobs</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="keyword">LIKE</span> ‘IT\_<span class="operator">%</span>‘;</span><br></pre></td></tr></table></figure>

<p>如果使用\表示转义，要省略ESCAPE。如果不是\，则要加上ESCAPE。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> job_id</span><br><span class="line"><span class="keyword">FROM</span>   jobs</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="keyword">LIKE</span> ‘IT$_<span class="operator">%</span>‘ <span class="keyword">escape</span> ‘$‘;</span><br></pre></td></tr></table></figure>

<p><strong>4）NULL</strong></p>
<p>使用 IS (NOT) NULL 判断空值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, manager_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  manager_id <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554973812597.png" alt="1554973812597"></p>
<h4 id="2-2-3-逻辑运算符"><a href="#2-2-3-逻辑运算符" class="headerlink" title="2.2.3 逻辑运算符"></a>2.2.3 逻辑运算符</h4><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;&amp; （或AND）</td>
<td>逻辑且</td>
</tr>
<tr>
<td>||（或OR）</td>
<td>逻辑或</td>
</tr>
<tr>
<td>NOT</td>
<td>逻辑否</td>
</tr>
<tr>
<td>XOR</td>
<td>逻辑异或</td>
</tr>
</tbody></table>
<p><strong>1）&amp;&amp; （或AND）</strong></p>
<p><strong>AND要求并的关系为真。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">&gt;=</span><span class="number">10000</span></span><br><span class="line"><span class="keyword">AND</span>    job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%MAN%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554973941432.png" alt="1554973941432"></p>
<p><strong>2）||（或OR）</strong></p>
<p><strong>OR要求或关系为真。</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">&gt;=</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">OR</span>     job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%MAN%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554973982466.png" alt="1554973982466"></p>
<p><img src="/post/5d2c694a/1554974001609.png" alt="1554974001609"></p>
<p><strong>3）NOT</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="string">&#x27;IT_PROG&#x27;</span>, <span class="string">&#x27;ST_CLERK&#x27;</span>, <span class="string">&#x27;SA_REP&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554974033680.png" alt="1554974033680"></p>
<p><img src="/post/5d2c694a/1554974039660.png" alt="1554974039660"></p>
<p><strong>4）XOR</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name,department_id,salary </span><br><span class="line"><span class="keyword">from</span> employees</span><br><span class="line"><span class="keyword">where</span> department_id <span class="keyword">in</span> (<span class="number">10</span>,<span class="number">20</span>) XOR salary <span class="operator">&gt;</span> <span class="number">8000</span>;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-算术运算符"><a href="#2-2-4-算术运算符" class="headerlink" title="2.2.4 算术运算符"></a>2.2.4 算术运算符</h4><table>
<thead>
<tr>
<th>运算符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>加法</td>
</tr>
<tr>
<td>-</td>
<td>减法</td>
</tr>
<tr>
<td>*</td>
<td>乘法</td>
</tr>
<tr>
<td>/ （或div）</td>
<td>除法</td>
</tr>
<tr>
<td>%（或mod）</td>
<td>取模</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,salary,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id MOD <span class="number">2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>



<h3 id="2-3-排序数据和分页"><a href="#2-3-排序数据和分页" class="headerlink" title="2.3  排序数据和分页"></a>2.3  排序数据和分页</h3><h4 id="2-3-1-排序数据"><a href="#2-3-1-排序数据" class="headerlink" title="2.3.1 排序数据"></a>2.3.1 排序数据</h4><ul>
<li><p>使用 ORDER BY 子句排序</p>
<ul>
<li><strong>ASC（ascend）: 升序</strong></li>
<li><strong>DESC（descend）:降序</strong></li>
</ul>
</li>
<li><p><strong>ORDER BY 子句在SELECT语句的结尾。</strong></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   last_name, job_id, department_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554974255957.png" alt="1554974255957"></p>
<p><img src="/post/5d2c694a/1554974260133.png" alt="1554974260133"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   last_name, job_id, department_id, hire_date</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> hire_date <span class="keyword">DESC</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554974822229.png" alt="1554974822229"></p>
<p><img src="/post/5d2c694a/1554974827522.png" alt="1554974827522"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary<span class="operator">*</span><span class="number">12</span> annsal</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> annsal;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554974853194.png" alt="1554974853194"></p>
<p><img src="/post/5d2c694a/1554974858252.png" alt="1554974858252"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_id, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_id, salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554974901572.png" alt="1554974901572"></p>
<p><img src="/post/5d2c694a/1554974907498.png" alt="1554974907498"></p>
<ul>
<li>可以使用不在SELECT列表中的列排序。</li>
</ul>
<h4 id="2-3-2-分页"><a href="#2-3-2-分页" class="headerlink" title="2.3.2 分页"></a>2.3.2 分页</h4><ul>
<li><p><strong>MySQL中使用limit实现分页</strong></p>
</li>
<li><p>背景：查询返回的记录太多了，查看起来很不方便，怎么样能够实现分页查询呢？</p>
</li>
<li><p>分页原理</p>
<p>所谓分页显示，就是将数据库中的结果集，一段一段显示出来需要的条件。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--前10条记录：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="number">0</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--第11至20条记录：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="number">10</span>,<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--第21至30条记录： </span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> LIMIT <span class="number">20</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>公式<strong>：（当前页数-1）*每页条数，每页条数</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> </span><br><span class="line">LIMIT(PageNo <span class="operator">-</span> <span class="number">1</span>)<span class="operator">*</span>PageSize,PageSize;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>注意：limit子句必须放在整个查询语句的最后！</strong></li>
</ul>
<h3 id="2-4-多表查询"><a href="#2-4-多表查询" class="headerlink" title="2.4 多表查询"></a>2.4 多表查询</h3><h4 id="2-4-1-笛卡尔积错误"><a href="#2-4-1-笛卡尔积错误" class="headerlink" title="2.4.1 笛卡尔积错误"></a>2.4.1 笛卡尔积错误</h4><p>举例：</p>
<p><img src="/post/5d2c694a/1554974984600.png" alt="1554974984600"></p>
<p>从多个表中获取数据：</p>
<p><img src="/post/5d2c694a/1554975020388.png" alt="1554975020388"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> last_name, department_name</span><br><span class="line"><span class="keyword">from</span> employees, departments;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554975097631.png" alt="1554975097631"></p>
<p><strong>演示笛卡尔积的错误情况：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(employee_id) <span class="keyword">from</span> employees;</span><br><span class="line">输出<span class="number">107</span>行</span><br><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(department_id)<span class="keyword">from</span> departments;</span><br><span class="line">输出<span class="number">27</span>行</span><br><span class="line"><span class="keyword">select</span> <span class="number">107</span><span class="operator">*</span><span class="number">27</span> <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>笛卡尔积会在下面条件下产生</strong>：</p>
<ul>
<li>省略连接条件</li>
<li>连接条件无效</li>
<li>所有表中的所有行互相连接</li>
</ul>
</li>
<li><p>为了避免笛卡尔积， 可以<strong>在 WHERE 加入有效的连接条件。</strong></p>
</li>
</ul>
<p><strong>MySQL连接</strong></p>
<p>使用连接在多个表中查询数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>	table1.column, table2.column</span><br><span class="line"><span class="keyword">FROM</span>	table1, table2</span><br><span class="line"><span class="keyword">WHERE</span>	table1.column1 <span class="operator">=</span> table2.column2;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>在 WHERE子句中写入连接条件。</strong></p>
</li>
<li><p><strong>在表中有相同列时，在列名之前加上表名前缀。</strong></p>
</li>
</ul>
<h4 id="2-4-2-分类1：等值连接-vs-非等值连接"><a href="#2-4-2-分类1：等值连接-vs-非等值连接" class="headerlink" title="2.4.2 分类1：等值连接 vs 非等值连接"></a>2.4.2 分类1：等值连接 vs 非等值连接</h4><h5 id="①-等值连接"><a href="#①-等值连接" class="headerlink" title="① 等值连接"></a>① 等值连接</h5><p><img src="/post/5d2c694a/1554975496900.png" alt="1554975496900"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employees.employee_id, employees.last_name, </span><br><span class="line">       employees.department_id, departments.department_id,</span><br><span class="line">       departments.location_id</span><br><span class="line"><span class="keyword">FROM</span>   employees, departments</span><br><span class="line"><span class="keyword">WHERE</span>  employees.department_id <span class="operator">=</span> departments.department_id;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554975522600.png" alt="1554975522600"></p>
<p><img src="/post/5d2c694a/1554975526339.png" alt="1554975526339"></p>
<p><strong>多个连接条件与 AND 操作符</strong> </p>
<p><img src="/post/5d2c694a/1554975606231.png" alt="1554975606231"></p>
<p><strong>区分重复的列名</strong></p>
<ul>
<li><p><strong>使用表名前缀在多个表中区分相同的列</strong>。</p>
</li>
<li><p>在不同表中具有相同列名的列可以用<strong>表的别名</strong>加以区分。</p>
</li>
</ul>
<p><strong>表的别名</strong></p>
<ul>
<li><p>使用别名可以简化查询。</p>
</li>
<li><p>使用表名前缀可以提高执行效率。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, e.department_id,</span><br><span class="line">       d.department_id, d.location_id</span><br><span class="line"><span class="keyword">FROM</span>   employees e , departments d</span><br><span class="line"><span class="keyword">WHERE</span>  e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>



<p><strong>连接多个表</strong></p>
<p><img src="/post/5d2c694a/1554978354431.png" alt="1554978354431"></p>
<p><strong>连接 n个表,至少需要n-1个连接条件。</strong><br>例如：连接三个表，至少需要两个连接条件。</p>
<p>练习：查询出公司员工的 last_name,department_name, city</p>
<h5 id="②-非等值连接"><a href="#②-非等值连接" class="headerlink" title="② 非等值连接"></a>② 非等值连接</h5><p><img src="/post/5d2c694a/1554978442447.png" alt="1554978442447"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.salary, j.grade_level</span><br><span class="line"><span class="keyword">FROM</span>   employees e, job_grades j</span><br><span class="line"><span class="keyword">WHERE</span>  e.salary <span class="keyword">BETWEEN</span> j.lowest_sal <span class="keyword">AND</span> j.highest_sal;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554978477013.png" alt="1554978477013"></p>
<p><img src="/post/5d2c694a/1554978482652.png" alt="1554978482652"></p>
<h4 id="2-4-3-分类2：自连接-vs-非自连接"><a href="#2-4-3-分类2：自连接-vs-非自连接" class="headerlink" title="2.4.3 分类2：自连接 vs 非自连接"></a>2.4.3 分类2：自连接 vs 非自连接</h4><p><img src="/post/5d2c694a/1554978514321.png" alt="1554978514321"></p>
<ul>
<li>当table1和table2本质上是同一张表，只是用取别名的方式虚拟成两张表以代表不同的意义。然后两个表再进行内连接，外连接等查询</li>
</ul>
<p><strong>题目：查询employees表，返回“Xxx  works for Xxx”</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> CONCAT(worker.last_name ,<span class="string">&#x27; works for &#x27;</span> </span><br><span class="line">       , manager.last_name)</span><br><span class="line"><span class="keyword">FROM</span>   employees worker, employees manager</span><br><span class="line"><span class="keyword">WHERE</span>  worker.manager_id <span class="operator">=</span> manager.employee_id ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554978684947.png" alt="1554978684947"></p>
<p><img src="/post/5d2c694a/1554978690764.png" alt="1554978690764"></p>
<p>练习：查询出last_name为 ‘Chen’ 的员工的 manager 的信息</p>
<h4 id="2-4-4-分类3：内连接-vs-外连接"><a href="#2-4-4-分类3：内连接-vs-外连接" class="headerlink" title="2.4.4 分类3：内连接 vs 外连接"></a>2.4.4 分类3：内连接 vs 外连接</h4><p><img src="/post/5d2c694a/1554978955659.png" alt="1554978955659"></p>
<ul>
<li><p>内连接: 合并具有同一列的两个以上的表的行, <strong>结果集中不包含一个表与另一个表不匹配的行</strong></p>
</li>
<li><p>外连接: 两个表在连接过程中除了返回满足连接条件的行以外<strong>还返回左（或右）表中不满足条件的行</strong> <strong>，这种连接称为左（或右） 外连接</strong>。没有匹配的行时, 结果表中相应的列为空(NULL)。</p>
</li>
</ul>
<h5 id="①-SQL99：使用ON子句创建连接"><a href="#①-SQL99：使用ON子句创建连接" class="headerlink" title="① SQL99：使用ON子句创建连接"></a>① SQL99：使用ON子句创建连接</h5><ul>
<li><p>自然连接中是以具有相同名字的列为连接条件的。</p>
</li>
<li><p><strong>可以使用</strong> <strong>ON</strong> <strong>子句指定额外的连接条件</strong>。</p>
</li>
<li><p>这个连接条件是与其它条件分开的。</p>
</li>
<li><p><strong>ON</strong> <strong>子句使语句具有更高的易读性</strong>。</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.employee_id, e.last_name, e.department_id, </span><br><span class="line">       d.department_id, d.location_id</span><br><span class="line"><span class="keyword">FROM</span>   employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span>     (e.department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554979073996.png" alt="1554979073996"></p>
<p><img src="/post/5d2c694a/1554979079395.png" alt="1554979079395"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, city, department_name</span><br><span class="line"><span class="keyword">FROM</span>   employees e </span><br><span class="line"><span class="keyword">JOIN</span>   departments d</span><br><span class="line"><span class="keyword">ON</span>     d.department_id <span class="operator">=</span> e.department_id </span><br><span class="line"><span class="keyword">JOIN</span>   locations l</span><br><span class="line"><span class="keyword">ON</span>     d.location_id <span class="operator">=</span> l.location_id;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554979110008.png" alt="1554979110008"></p>
<p><img src="/post/5d2c694a/1554979115642.png" alt="1554979115642"></p>
<ul>
<li><strong>USING的使用</strong> (了解)</li>
</ul>
<p>只能和JOIN一起使用，而且要求<strong>两个</strong>关联字段在关联表中名称一致，而且只能表示关联字段值相等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,department_name</span><br><span class="line"><span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">USING</span> (department_id);</span><br></pre></td></tr></table></figure>



<h5 id="②-左外连接"><a href="#②-左外连接" class="headerlink" title="② 左外连接"></a>② 左外连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span>   employees e</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span>   (e.department_id <span class="operator">=</span> d.department_id) ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554979200961.png" alt="1554979200961"></p>
<h5 id="③-右外连接"><a href="#③-右外连接" class="headerlink" title="③ 右外连接"></a>③ 右外连接</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name, e.department_id, d.department_name</span><br><span class="line"><span class="keyword">FROM</span>   employees e</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span>    (e.department_id <span class="operator">=</span> d.department_id) ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554979243194.png" alt="1554979243194"></p>
<h5 id="总结：SQL-JOINS"><a href="#总结：SQL-JOINS" class="headerlink" title="总结：SQL JOINS"></a>总结：SQL JOINS</h5><p><img src="/post/5d2c694a/1554979255233.png" alt="1554979255233"></p>
<p>补充：</p>
<p><strong>UNION操作符</strong></p>
<p><img src="/post/5d2c694a/1554979317187.png" alt="1554979317187"></p>
<p>UNION 操作符返回两个查询的结果集的并集。</p>
<p><strong>UNION ALL操作符</strong></p>
<p><img src="/post/5d2c694a/1554979343634.png" alt="1554979343634"></p>
<p>UNION ALL操作符返回两个查询的结果集的并集。对于两个结果集的重复部分，不去重。</p>
<h3 id="2-5-单行函数"><a href="#2-5-单行函数" class="headerlink" title="2.5 单行函数"></a>2.5 单行函数</h3><h4 id="2-5-1-介绍"><a href="#2-5-1-介绍" class="headerlink" title="2.5.1 介绍"></a>2.5.1 介绍</h4><p><img src="/post/5d2c694a/1554979529525.png" alt="1554979529525"></p>
<p><strong>两种SQL函数</strong></p>
<p><img src="/post/5d2c694a/1555433204337.png" alt="1555433204337"></p>
<p><strong>单行函数</strong></p>
<ul>
<li><p>操作数据对象</p>
</li>
<li><p>接受参数返回一个结果</p>
</li>
<li><p><strong>只对一行进行变换</strong></p>
</li>
<li><p><strong>每行返回一个结果</strong></p>
</li>
<li><p>可以嵌套</p>
</li>
<li><p>参数可以是一列或一个值</p>
</li>
</ul>
<h4 id="2-5-2-字符串函数"><a href="#2-5-2-字符串函数" class="headerlink" title="2.5.2 字符串函数"></a>2.5.2 字符串函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>CONCAT(S1,S2,……,Sn)</td>
<td>连接S1,S2,……,Sn为一个字符串</td>
</tr>
<tr>
<td>CONCAT_WS(s, S1,S2,……,Sn)</td>
<td>同CONCAT(s1,s2,…)函数，但是每个字符串之间要加上s</td>
</tr>
<tr>
<td>CHAR_LENGTH(s)</td>
<td>返回字符串s的字符数</td>
</tr>
<tr>
<td>LENGTH(s)</td>
<td>返回字符串s的字节数，和字符集有关</td>
</tr>
<tr>
<td>INSERT(str, index , len, instr)</td>
<td>将字符串str从第index位置开始，len个字符长的子串替换为字符串instr</td>
</tr>
<tr>
<td>UPPER(s) 或 UCASE(s)</td>
<td>将字符串s的所有字母转成大写字母</td>
</tr>
<tr>
<td>LOWER(s)  或LCASE(s)</td>
<td>将字符串s的所有字母转成小写字母</td>
</tr>
<tr>
<td>LEFT(s,n)</td>
<td>返回字符串s最左边的n个字符</td>
</tr>
<tr>
<td>RIGHT(s,n)</td>
<td>返回字符串s最右边的n个字符</td>
</tr>
<tr>
<td>LPAD(str, len, pad)</td>
<td>用字符串pad对str最左边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td>RPAD(str ,len, pad)</td>
<td>用字符串pad对str最右边进行填充，直到str的长度为len个字符</td>
</tr>
<tr>
<td>LTRIM(s)</td>
<td>去掉字符串s左侧的空格</td>
</tr>
<tr>
<td>RTRIM(s)</td>
<td>去掉字符串s右侧的空格</td>
</tr>
<tr>
<td>TRIM(s)</td>
<td>去掉字符串s开始与结尾的空格</td>
</tr>
<tr>
<td>TRIM(【BOTH 】s1 FROM s)</td>
<td>去掉字符串s开始与结尾的s1</td>
</tr>
<tr>
<td>TRIM(LEADING s1 FROM s)</td>
<td>去掉字符串s开始处的s1</td>
</tr>
<tr>
<td>TRIM(TRAILING s1 FROM s)</td>
<td>去掉字符串s结尾处的s1</td>
</tr>
<tr>
<td>REPEAT(str, n)</td>
<td>返回str重复n次的结果</td>
</tr>
<tr>
<td>REPLACE（str, a, b）</td>
<td>用字符串b替换字符串str中所有出现的字符串a</td>
</tr>
<tr>
<td>STRCMP(s1,s2)</td>
<td>比较字符串s1,s2</td>
</tr>
<tr>
<td>SUBSTRING(s,index,len)</td>
<td>返回从字符串s的index位置其len个字符</td>
</tr>
</tbody></table>
<ul>
<li><strong>举例1：大小写控制函数</strong></li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td><strong>LOWER(‘SQL Course’)</strong></td>
<td><strong>sql course</strong></td>
</tr>
<tr>
<td><strong>UPPER(‘SQL Course’)</strong></td>
<td><strong>SQL COURSE</strong></td>
</tr>
</tbody></table>
<blockquote>
<p>这类函数改变字符的大小写。</p>
</blockquote>
<ul>
<li><strong>举例2：字符控制函数</strong></li>
</ul>
<table>
<thead>
<tr>
<th>函数</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CONCAT(‘Hello’,’World’)</strong></td>
<td><strong>HelloWorld</strong></td>
</tr>
<tr>
<td><strong>SUBSTR(‘HelloWorld’,1,5)</strong></td>
<td><strong>Hello</strong></td>
</tr>
<tr>
<td><strong>LENGTH(‘HelloWorld’)</strong></td>
<td><strong>10</strong></td>
</tr>
<tr>
<td><strong>INSTR(‘HelloWorld’,’W’)</strong></td>
<td><strong>6</strong></td>
</tr>
<tr>
<td><strong>LPAD(salary,10,’*‘)</strong></td>
<td><strong>*****24000</strong></td>
</tr>
<tr>
<td><strong>RPAD(salary,10, ‘*‘)</strong></td>
<td><strong>24000*<em>*</em>***</strong></td>
</tr>
<tr>
<td><strong>TRIM(‘H’ FROM ‘HelloWorld’)</strong></td>
<td><strong>elloWorld</strong></td>
</tr>
<tr>
<td><strong>REPLACE(‘abcd’,’b’,’m’)</strong></td>
<td><strong>amcd</strong></td>
</tr>
</tbody></table>
<h4 id="2-5-3-数值函数"><a href="#2-5-3-数值函数" class="headerlink" title="2.5.3 数值函数"></a>2.5.3 数值函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>ABS(x)</td>
<td>返回x的绝对值</td>
</tr>
<tr>
<td>CEIL(x)</td>
<td>返回大于x的最小整数值</td>
</tr>
<tr>
<td>FLOOR(x)</td>
<td>返回小于x的最大整数值</td>
</tr>
<tr>
<td>MOD(x,y)</td>
<td>返回x/y的模</td>
</tr>
<tr>
<td>RAND()</td>
<td>返回0~1的随机值</td>
</tr>
<tr>
<td>ROUND(x,y)</td>
<td>返回参数x的四舍五入的有y位的小数的值</td>
</tr>
<tr>
<td>TRUNCATE(x,y)</td>
<td>返回数字x截断为y位小数的结果</td>
</tr>
<tr>
<td>SQRT(x)</td>
<td>返回x的平方根</td>
</tr>
<tr>
<td>POW(x,y)</td>
<td>返回x的y次方</td>
</tr>
</tbody></table>
<ul>
<li><strong>举例1：ROUND:四舍五入</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROUND(45.926, 2)     --&gt;  45.93</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>举例2：TRUNCATE:截断</strong></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TRUNCATE(45.926)      --&gt; 45</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>举例3：MOD:求余</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">MOD</span>(<span class="number">1600</span>, <span class="number">300</span>)	 <span class="comment">--&gt; 100</span></span><br></pre></td></tr></table></figure>



<h4 id="2-5-4-日期函数"><a href="#2-5-4-日期函数" class="headerlink" title="2.5.4 日期函数"></a>2.5.4 日期函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td><strong>CURDATE()</strong> 或 CURRENT_DATE()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td><strong>CURTIME()</strong> 或 CURRENT_TIME()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td><strong>NOW()</strong> / SYSDATE() / CURRENT_TIMESTAMP() / LOCALTIME() / LOCALTIMESTAMP()</td>
<td>返回当前系统日期时间</td>
</tr>
<tr>
<td><strong>YEAR(date) / MONTH(date) / DAY(date) / HOUR(time) / MINUTE(time) / SECOND(time)</strong></td>
<td>返回具体的时间值</td>
</tr>
<tr>
<td>WEEK(date) / WEEKOFYEAR(date)</td>
<td>返回一年中的第几周</td>
</tr>
<tr>
<td>DAYOFWEEK(date)</td>
<td>返回周几，注意：周日是1，周一是2，。。。周六是7</td>
</tr>
<tr>
<td>WEEKDAY(date)</td>
<td>返回周几，注意，周1是0，周2是1，。。。周日是6</td>
</tr>
<tr>
<td>DAYNAME(date)</td>
<td>返回星期：MONDAY,TUESDAY…..SUNDAY</td>
</tr>
<tr>
<td>MONTHNAME(date)</td>
<td>返回月份：January，。。。。。</td>
</tr>
<tr>
<td>DATEDIFF(date1,date2) / TIMEDIFF(time1, time2)</td>
<td>返回date1 - date2的日期间隔 / 返回time1 - time2的时间间隔</td>
</tr>
<tr>
<td>DATE_ADD(datetime, INTERVAL  expr type)</td>
<td>返回与给定日期时间相差INTERVAL时间段的日期时间</td>
</tr>
<tr>
<td>DATE_FORMAT(datetime ,fmt)</td>
<td>按照字符串fmt格式化日期datetime值</td>
</tr>
<tr>
<td>STR_TO_DATE(str, fmt)</td>
<td>按照字符串fmt对str进行解析，解析为一个日期</td>
</tr>
</tbody></table>
<p>其中：</p>
<p><strong>（1）DATE_ADD(datetime,INTERVAL  expr type)</strong></p>
<p>表达式类型：</p>
<table>
<thead>
<tr>
<th>参数类型</th>
<th>参数类型</th>
</tr>
</thead>
<tbody><tr>
<td>YEAR</td>
<td>YEAR_MONTH</td>
</tr>
<tr>
<td>MONTH</td>
<td>DAY_HOUR</td>
</tr>
<tr>
<td>DAY</td>
<td>DAY_MINUTE</td>
</tr>
<tr>
<td>HOUR</td>
<td>DAY_SECOND</td>
</tr>
<tr>
<td>MINUTE</td>
<td>HOUR_MINUTE</td>
</tr>
<tr>
<td>SECOND</td>
<td>HOUR_SECOND</td>
</tr>
<tr>
<td></td>
<td>MINUTE_SECOND</td>
</tr>
</tbody></table>
<p>举例：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">1</span> <span class="keyword">YEAR</span>);</span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="number">-1</span> <span class="keyword">YEAR</span>);   #可以是负数</span><br><span class="line"><span class="keyword">SELECT</span> DATE_ADD(NOW(), <span class="type">INTERVAL</span> <span class="string">&#x27;1_1&#x27;</span> YEAR_MONTH);   #需要单引号</span><br></pre></td></tr></table></figure>



<p><strong>（2）DATE_FORMAT(datetime,fmt) 和 STR_TO_DATE(str, fmt)</strong></p>
<table>
<thead>
<tr>
<th>格式符</th>
<th>说明</th>
<th>格式符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>%Y</td>
<td>4位数字表示年份</td>
<td>%y</td>
<td>表示两位数字表示年份</td>
</tr>
<tr>
<td>%M</td>
<td>月名表示月份（January,….）</td>
<td>%m</td>
<td>两位数字表示月份（01,02,03。。。）</td>
</tr>
<tr>
<td>%b</td>
<td>缩写的月名（Jan.，Feb.，….）</td>
<td>%c</td>
<td>数字表示月份（1,2,3,…）</td>
</tr>
<tr>
<td>%D</td>
<td>英文后缀表示月中的天数（1st,2nd,3rd,…）</td>
<td>%d</td>
<td>两位数字表示月中的天数(01,02…)</td>
</tr>
<tr>
<td>%e</td>
<td>数字形式表示月中的天数（1,2,3,4,5…..）</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%H</td>
<td>两位数字表示小数，24小时制（01,02..）</td>
<td>%h和%I</td>
<td>两位数字表示小时，12小时制（01,02..）</td>
</tr>
<tr>
<td>%k</td>
<td>数字形式的小时，24小时制(1,2,3)</td>
<td>%l</td>
<td>数字形式表示小时，12小时制（1,2,3,4….）</td>
</tr>
<tr>
<td>%i</td>
<td>两位数字表示分钟（00,01,02）</td>
<td>%S和%s</td>
<td>两位数字表示秒(00,01,02…)</td>
</tr>
<tr>
<td>%W</td>
<td>一周中的星期名称（Sunday…）</td>
<td>%a</td>
<td>一周中的星期缩写（Sun.，Mon.,Tues.，..）</td>
</tr>
<tr>
<td>%w</td>
<td>以数字表示周中的天数(0=Sunday,1=Monday….)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%j</td>
<td>以3位数字表示年中的天数(001,002…)</td>
<td>%U</td>
<td>以数字表示年中的第几周，（1,2,3。。）其中Sunday为周中第一天</td>
</tr>
<tr>
<td>%u</td>
<td>以数字表示年中的第几周，（1,2,3。。）其中Monday为周中第一天</td>
<td></td>
<td></td>
</tr>
<tr>
<td>%T</td>
<td>24小时制</td>
<td>%r</td>
<td>12小时制</td>
</tr>
<tr>
<td>%p</td>
<td>AM或PM</td>
<td>%%</td>
<td>表示%</td>
</tr>
</tbody></table>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT STR_TO_DATE(&#x27;09/01/2009&#x27;,&#x27;%m/%d/%Y&#x27;)</span><br><span class="line">FROM DUAL;</span><br><span class="line"></span><br><span class="line">SELECT STR_TO_DATE(&#x27;20140422154706&#x27;,&#x27;%Y%m%d%H%i%s&#x27;)</span><br><span class="line">FROM DUAL;</span><br><span class="line"></span><br><span class="line">SELECT STR_TO_DATE(&#x27;2014-04-22 15:47:06&#x27;,&#x27;%Y-%m-%d %H:%i:%s&#x27;)</span><br><span class="line">FROM DUAL;</span><br></pre></td></tr></table></figure>



<h4 id="2-5-5-流程函数"><a href="#2-5-5-流程函数" class="headerlink" title="2.5.5 流程函数"></a>2.5.5 流程函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>IF(value,t ,f)</td>
<td>如果value是真，返回t，否则返回f</td>
</tr>
<tr>
<td>IFNULL(value1, value2)</td>
<td>如果value1不为空，返回value1，否则返回value2</td>
</tr>
<tr>
<td>CASE WHEN 条件1 THEN result1 WHEN 条件2 THEN result2 …. [ELSE resultn] END</td>
<td>相当于Java的if…else if…else…</td>
</tr>
<tr>
<td>CASE  expr WHEN 常量值1 THEN 值1 WHEN 常量值1 THEN 值1 …. [ELSE 值n] END</td>
<td>相当于Java的switch…case…</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,salary, <span class="keyword">CASE</span> <span class="keyword">WHEN</span> salary<span class="operator">&gt;=</span><span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;高薪&#x27;</span> </span><br><span class="line">				  <span class="keyword">WHEN</span> salary<span class="operator">&gt;=</span><span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;潜力股&#x27;</span>  </span><br><span class="line">				  <span class="keyword">WHEN</span> salary<span class="operator">&gt;=</span><span class="number">8000</span> <span class="keyword">THEN</span> <span class="string">&#x27;屌丝&#x27;</span> </span><br><span class="line">				  <span class="keyword">ELSE</span> <span class="string">&#x27;草根&#x27;</span> <span class="keyword">END</span>  &quot;描述&quot;</span><br><span class="line"><span class="keyword">FROM</span> employees; </span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> oid,`status`, <span class="keyword">CASE</span> `status` <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">&#x27;未付款&#x27;</span> </span><br><span class="line">								   <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">&#x27;已付款&#x27;</span> </span><br><span class="line">								   <span class="keyword">WHEN</span> <span class="number">3</span> <span class="keyword">THEN</span> <span class="string">&#x27;已发货&#x27;</span>  </span><br><span class="line">								   <span class="keyword">WHEN</span> <span class="number">4</span> <span class="keyword">THEN</span> <span class="string">&#x27;确认收货&#x27;</span>  </span><br><span class="line">								   <span class="keyword">ELSE</span> <span class="string">&#x27;无效订单&#x27;</span> <span class="keyword">END</span> </span><br><span class="line"><span class="keyword">FROM</span> t_order;</span><br></pre></td></tr></table></figure>



<ul>
<li>举例1：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,<span class="number">12</span> <span class="operator">*</span> salary <span class="operator">*</span> (<span class="number">1</span> <span class="operator">+</span> IFNULL(commission_pct,<span class="number">0</span>))</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>举例2：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary,</span><br><span class="line">       <span class="keyword">CASE</span> job_id <span class="keyword">WHEN</span> <span class="string">&#x27;IT_PROG&#x27;</span>  <span class="keyword">THEN</span>  <span class="number">1.10</span><span class="operator">*</span>salary</span><br><span class="line">                   <span class="keyword">WHEN</span> <span class="string">&#x27;ST_CLERK&#x27;</span> <span class="keyword">THEN</span>  <span class="number">1.15</span><span class="operator">*</span>salary</span><br><span class="line">                   <span class="keyword">WHEN</span> <span class="string">&#x27;SA_REP&#x27;</span>   <span class="keyword">THEN</span>  <span class="number">1.20</span><span class="operator">*</span>salary</span><br><span class="line">       <span class="keyword">ELSE</span>      salary <span class="keyword">END</span>     &quot;REVISED_SALARY&quot;</span><br><span class="line"><span class="keyword">FROM</span>   employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554980865631.png" alt="1554980865631"></p>
<p><strong>练习：查询部门号为 10,20, 30 的员工信息, 若部门号为 10, 则打印其工资的 1.1 倍, 20 号部门, 则打印其工资的 1.2 倍, 30 号部门打印其工资的 1.3 倍数。</strong></p>
<h4 id="2-5-6-其他函数"><a href="#2-5-6-其他函数" class="headerlink" title="2.5.6 其他函数"></a>2.5.6 其他函数</h4><table>
<thead>
<tr>
<th>函数</th>
<th>用法</th>
</tr>
</thead>
<tbody><tr>
<td>database()</td>
<td>返回当前数据库名</td>
</tr>
<tr>
<td>version()</td>
<td>返回当前数据库版本</td>
</tr>
<tr>
<td>user()</td>
<td>返回当前登录用户名</td>
</tr>
<tr>
<td>password(str)</td>
<td>返回字符串str的加密版本，41位长的字符串</td>
</tr>
<tr>
<td>md5(str)</td>
<td>返回字符串str的md5值，也是一种加密方式</td>
</tr>
</tbody></table>
<h3 id="2-6-分组函数"><a href="#2-6-分组函数" class="headerlink" title="2.6 分组函数"></a>2.6 分组函数</h3><h4 id="2-6-1-组函数介绍"><a href="#2-6-1-组函数介绍" class="headerlink" title="2.6.1 组函数介绍"></a>2.6.1 组函数介绍</h4><ul>
<li><strong>什么是分组函数</strong></li>
</ul>
<p>分组函数作用于一组数据，并对一组数据返回一个值。</p>
<p><img src="/post/5d2c694a/1554980924940.png" alt="1554980924940"></p>
<ul>
<li><p><strong>组函数类型</strong></p>
<ul>
<li><strong>AVG()</strong> </li>
<li><strong>SUM()</strong></li>
<li><strong>MAX()</strong> </li>
<li><strong>MIN()</strong> </li>
<li>**COUNT() **</li>
</ul>
</li>
<li><p>组函数语法</p>
</li>
</ul>
<p><img src="/post/5d2c694a/1554981029920.png" alt="1554981029920"></p>
<h4 id="2-6-2-AVG和SUM函数"><a href="#2-6-2-AVG和SUM函数" class="headerlink" title="2.6.2 AVG和SUM函数"></a>2.6.2 AVG和SUM函数</h4><p>可以对<strong>数值型数据</strong>使用AVG 和 SUM 函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary), <span class="built_in">MAX</span>(salary),<span class="built_in">MIN</span>(salary), <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%REP%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981279723.png" alt="1554981279723"></p>
<h4 id="2-6-3-MIN和MAX函数"><a href="#2-6-3-MIN和MAX函数" class="headerlink" title="2.6.3 MIN和MAX函数"></a>2.6.3 MIN和MAX函数</h4><p>可以对<strong>任意数据类型</strong>的数据使用 MIN 和 MAX 函数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">MIN</span>(hire_date), <span class="built_in">MAX</span>(hire_date)</span><br><span class="line"><span class="keyword">FROM</span>	  employees;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981253194.png" alt="1554981253194"></p>
<h4 id="2-6-4-COUNT函数"><a href="#2-6-4-COUNT函数" class="headerlink" title="2.6.4 COUNT函数"></a>2.6.4 COUNT函数</h4><p>COUNT(*)返回表中记录总数,适用于<strong>任意数据类型</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span>	  employees</span><br><span class="line"><span class="keyword">WHERE</span>  department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981241299.png" alt="1554981241299"></p>
<p>•COUNT(expr) 返回<strong>expr不为空</strong>的记录总数。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(commission_pct)</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981328678.png" alt="1554981328678"></p>
<ul>
<li><p><strong>问题：用count(*)，count(1)谁好呢?</strong></p>
<p>其实，对于myisam引擎的表是没有区别的。这种引擎内部有一计数器在维护着行数。</p>
<p>Innodb引擎的表用count(*)直接读行数，效率很低，因为innodb真的要去数一遍。</p>
</li>
</ul>
<h4 id="2-6-5-GROUP-BY"><a href="#2-6-5-GROUP-BY" class="headerlink" title="2.6.5 GROUP BY"></a>2.6.5 GROUP BY</h4><p><img src="/post/5d2c694a/1554981374920.png" alt="1554981374920"></p>
<p><strong>可以使用GROUP BY子句将表中的数据分成若干组</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>, group_function(<span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">[<span class="keyword">WHERE</span>	<span class="keyword">condition</span>]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span>	group_by_expression]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span>	<span class="keyword">column</span>];</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>明确：WHERE一定放在FROM后面</strong></p>
</blockquote>
<p><strong>在SELECT列表中所有未包含在组函数中的列都应该包含在 GROUP BY子句中</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981539408.png" alt="1554981539408"></p>
<p><img src="/post/5d2c694a/1554981544191.png" alt="1554981544191"></p>
<p>包含在 GROUP BY 子句中的列不必包含在SELECT 列表中</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981574152.png" alt="1554981574152"></p>
<p><strong>使用多个列分组</strong></p>
<p><img src="/post/5d2c694a/1554981607442.png" alt="1554981607442"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   department_id dept_id, job_id, <span class="built_in">SUM</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id, job_id ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981624864.png" alt="1554981624864"></p>
<p><img src="/post/5d2c694a/1554981629733.png" alt="1554981629733"></p>
<h4 id="2-6-6-HAVING"><a href="#2-6-6-HAVING" class="headerlink" title="2.6.6 HAVING"></a>2.6.6 HAVING</h4><p><img src="/post/5d2c694a/1554981656798.png" alt="1554981656798"></p>
<ul>
<li><strong>非法使用组函数</strong><ul>
<li><strong>不能在</strong> <strong>WHERE</strong> <strong>子句中使用组函数。</strong></li>
<li><strong>可以在</strong> <strong>HAVING</strong> <strong>子句中使用组函数。</strong></li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   department_id, <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">WHERE</span>    <span class="built_in">AVG</span>(salary) <span class="operator">&gt;</span> <span class="number">8000</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981724375.png" alt="1554981724375"></p>
<p><strong>过滤分组：HAVING子句</strong></p>
<ol>
<li>行已经被分组。</li>
<li>使用了组函数。</li>
<li>满足HAVING 子句中条件的分组将被显示。</li>
</ol>
<p><img src="/post/5d2c694a/1554981808091.png" alt="1554981808091"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   department_id, <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span>   <span class="built_in">MAX</span>(salary)<span class="operator">&gt;</span><span class="number">10000</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554981824564.png" alt="1554981824564"></p>
<h3 id="2-7-小结"><a href="#2-7-小结" class="headerlink" title="2.7 小结"></a>2.7 小结</h3><ul>
<li>查询的结构</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SELECT ...,....,...</span><br><span class="line">FROM ...,...,....</span><br><span class="line">WHERE 多表的连接条件</span><br><span class="line">AND 不包含组函数的过滤条件</span><br><span class="line">GROUP BY ...,...</span><br><span class="line">HAVING 包含组函数的过滤条件</span><br><span class="line">ORDER BY ... ASC/DESC</span><br><span class="line">LIMIT ...,...</span><br><span class="line">或</span><br><span class="line">SELECT ...,....,...</span><br><span class="line">FROM ... JOIN ... </span><br><span class="line">ON 多表的连接条件</span><br><span class="line">JOIN ...</span><br><span class="line">ON ...</span><br><span class="line">WHERE 不包含组函数的过滤条件</span><br><span class="line">AND/OR 不包含组函数的过滤条件</span><br><span class="line">GROUP BY ...,...</span><br><span class="line">HAVING 包含组函数的过滤条件</span><br><span class="line">ORDER BY ... ASC/DESC</span><br><span class="line">LIMIT ...,...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>执行的顺序</p>
<p><img src="/post/5d2c694a/1566872301088.png" alt="1566872301088"></p>
</li>
</ul>
<h3 id="2-8注意事项"><a href="#2-8注意事项" class="headerlink" title="2.8注意事项"></a>2.8注意事项</h3><ol>
<li>select中出现了组函数和非组函数的字段，那么非组函数的字段一定要声明在group by中。<br>反之，声明在group by中的字段，可以不声明在select中。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#如下的语句是正确的：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"></span><br><span class="line">#错误的：</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">AVG</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果过滤条件中出现了组函数，则需要使用having替换where实现过滤</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#需求：查询部门最高工资比<span class="number">10000</span>高的部门及其最高工资</span><br><span class="line">#错误的</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id </span><br><span class="line"></span><br><span class="line">#正确的</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">10000</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>having 是全遍历后再过滤,而where是边遍历边过滤, 所以在都可以用的情况下,用where效率高</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#需求：查询<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>号部门中，部门最高工资比<span class="number">10000</span>高的部门及其最高工资</span><br><span class="line">#写法一：推荐！优于写法二，因为效率高</span><br><span class="line">#结论：如果过滤条件<span class="number">1</span>中出现了组函数，那么将过滤条件<span class="number">1</span>声明在<span class="keyword">having</span>中</span><br><span class="line">#      如果过滤条件<span class="number">2</span>中没有出现组函数，推荐将过滤条件<span class="number">2</span>声明在<span class="keyword">where</span>中。</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="keyword">IN</span> (<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line"></span><br><span class="line">#写法二：</span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id </span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">MAX</span>(salary) <span class="operator">&gt;</span> <span class="number">10000</span></span><br><span class="line"><span class="keyword">AND</span> department_id <span class="keyword">IN</span> (<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>);</span><br></pre></td></tr></table></figure>



<h2 id="第3章：子查询"><a href="#第3章：子查询" class="headerlink" title="第3章：子查询"></a>第3章：子查询</h2><h3 id="3-1-基本介绍"><a href="#3-1-基本介绍" class="headerlink" title="3.1 基本介绍"></a>3.1 基本介绍</h3><p>实际问题：</p>
<p><img src="/post/5d2c694a/1554991034688.png" alt="1554991034688"></p>
<hr>
<p><img src="/post/5d2c694a/1554991054388.png" alt="1554991054388"></p>
<ul>
<li><p><strong>子查询 (内查询) 在主查询之前一次执行完成。</strong></p>
</li>
<li><p><strong>子查询的结果被主查询(外查询)使用 。</strong></p>
</li>
<li><p><strong>子查询的类型：</strong></p>
<ul>
<li><p>单行子查询</p>
<p><img src="/post/5d2c694a/1554991538719.png" alt="1554991538719"></p>
</li>
<li><p>多行子查询</p>
</li>
</ul>
<p><img src="/post/5d2c694a/1554991555669.png" alt="1554991555669"></p>
</li>
<li><p><strong>注意事项</strong></p>
<ul>
<li><strong>子查询要包含在括号内</strong></li>
<li><strong>将子查询放在比较条件的右侧</strong></li>
<li>单行操作符对应单行子查询，多行操作符对应多行子查询</li>
</ul>
</li>
</ul>
<h3 id="3-2-单行子查询"><a href="#3-2-单行子查询" class="headerlink" title="3.2 单行子查询"></a>3.2 单行子查询</h3><h4 id="3-2-1-单行比较操作符"><a href="#3-2-1-单行比较操作符" class="headerlink" title="3.2.1 单行比较操作符"></a>3.2.1 单行比较操作符</h4><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>=</td>
<td>equal to</td>
</tr>
<tr>
<td>&gt;</td>
<td>greater than</td>
</tr>
<tr>
<td>&gt;=</td>
<td>greater than or equal to</td>
</tr>
<tr>
<td>&lt;</td>
<td>less than</td>
</tr>
<tr>
<td>&lt;=</td>
<td>less than or equal to</td>
</tr>
<tr>
<td>&lt;&gt;</td>
<td>not equal to</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">&gt;</span></span><br><span class="line">               (<span class="keyword">SELECT</span> salary</span><br><span class="line">                <span class="keyword">FROM</span>   employees</span><br><span class="line">                <span class="keyword">WHERE</span>  last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554991316599.png" alt="1554991316599"></p>
<p><strong>题目：返回job_id与141号员工相同，salary比143号员工多的员工姓名，job_id和工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="operator">=</span>  </span><br><span class="line">                (<span class="keyword">SELECT</span> job_id</span><br><span class="line">                 <span class="keyword">FROM</span>   employees</span><br><span class="line">                 <span class="keyword">WHERE</span>  employee_id <span class="operator">=</span> <span class="number">141</span>)</span><br><span class="line"><span class="keyword">AND</span>    salary <span class="operator">&gt;</span></span><br><span class="line">                (<span class="keyword">SELECT</span> salary</span><br><span class="line">                 <span class="keyword">FROM</span>   employees</span><br><span class="line">                 <span class="keyword">WHERE</span>  employee_id <span class="operator">=</span> <span class="number">143</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554991892770.png" alt="1554991892770"></p>
<p><strong>题目：返回公司工资最少的员工的last_name,job_id和salary</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">=</span> </span><br><span class="line">                (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">                 <span class="keyword">FROM</span>   employees);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554991935186.png" alt="1554991935186"></p>
<h4 id="3-2-2-子查询中的-HAVING-子句"><a href="#3-2-2-子查询中的-HAVING-子句" class="headerlink" title="3.2.2 子查询中的 HAVING 子句"></a>3.2.2 子查询中的 HAVING 子句</h4><ul>
<li>首先执行子查询。</li>
<li>向主查询中的HAVING 子句返回结果。</li>
</ul>
<p><strong>题目：查询最低工资大于50号部门最低工资的部门id和其最低工资</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>   department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span>     employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span>   <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span></span><br><span class="line">                       (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">                        <span class="keyword">FROM</span>   employees</span><br><span class="line">                        <span class="keyword">WHERE</span>  department_id <span class="operator">=</span> <span class="number">50</span>);</span><br></pre></td></tr></table></figure>



<h4 id="3-2-3-子查询中的空值问题"><a href="#3-2-3-子查询中的空值问题" class="headerlink" title="3.2.3 子查询中的空值问题"></a>3.2.3 子查询中的空值问题</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="operator">=</span></span><br><span class="line">                (<span class="keyword">SELECT</span> job_id</span><br><span class="line">                 <span class="keyword">FROM</span>   employees</span><br><span class="line">                 <span class="keyword">WHERE</span>  last_name <span class="operator">=</span> <span class="string">&#x27;Haas&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554992067381.png" alt="1554992067381"></p>
<blockquote>
<p><strong>子查询不返回任何行</strong></p>
</blockquote>
<h4 id="3-2-4-非法使用子查询"><a href="#3-2-4-非法使用子查询" class="headerlink" title="3.2.4 非法使用子查询"></a>3.2.4 非法使用子查询</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">=</span></span><br><span class="line">                (<span class="keyword">SELECT</span>   <span class="built_in">MIN</span>(salary)</span><br><span class="line">                 <span class="keyword">FROM</span>     employees</span><br><span class="line">                 <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554992135819.png" alt="1554992135819"></p>
<blockquote>
<p><strong>多行子查询使用单行比较符</strong></p>
</blockquote>
<h3 id="3-2-多行子查询"><a href="#3-2-多行子查询" class="headerlink" title="3.2 多行子查询"></a>3.2 多行子查询</h3><ul>
<li><p>返回多行。</p>
</li>
<li><p>使用多行比较操作符。</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>IN</td>
<td>等于列表中的<strong>任意一个</strong></td>
</tr>
<tr>
<td>ANY</td>
<td>和子查询返回的<strong>某一个</strong>值比较</td>
</tr>
<tr>
<td>ALL</td>
<td>和子查询返回的<strong>所有</strong>值比较</td>
</tr>
</tbody></table>
<blockquote>
<p>体会any和all的区别</p>
</blockquote>
<h4 id="3-2-1-使用ANY或ALL操作符"><a href="#3-2-1-使用ANY或ALL操作符" class="headerlink" title="3.2.1 使用ANY或ALL操作符"></a>3.2.1 使用ANY或ALL操作符</h4><p><strong>题目：返回其它job_id中比job_id为‘IT_PROG’部门任一工资低的员工的员工号、姓名、job_id 以及salary</strong></p>
<p><img src="/post/5d2c694a/1554992658876.png" alt="1554992658876"></p>
<p><img src="/post/5d2c694a/1554992664594.png" alt="1554992664594"></p>
<p><img src="/post/5d2c694a/1554992668429.png" alt="1554992668429"></p>
<p><strong>题目：返回其它job_id中比job_id为‘IT_PROG’部门所有工资都低的员工的员工号、姓名、job_id以及salary</strong></p>
<p><img src="/post/5d2c694a/1554992753654.png" alt="1554992753654"></p>
<p><img src="/post/5d2c694a/1554992759467.png" alt="1554992759467"></p>
<h4 id="3-2-2-空值问题"><a href="#3-2-2-空值问题" class="headerlink" title="3.2.2 空值问题"></a>3.2.2 空值问题</h4><p><img src="/post/5d2c694a/1554992822094.png" alt="1554992822094"></p>
<h3 id="3-3-相关子查询"><a href="#3-3-相关子查询" class="headerlink" title="3.3  相关子查询"></a>3.3  相关子查询</h3><p>相关子查询按照一行接一行的顺序执行，主查询的每一行都执行一次子查询。</p>
<p><img src="/post/5d2c694a/1554992898234.png" alt="1554992898234"></p>
<p><img src="/post/5d2c694a/1554992925281.png" alt="1554992925281"></p>
<p>说明：<strong>子查询中使用主查询中的列</strong></p>
<p><strong>题目：查询员工中工资大于本部门平均工资的员工的last_name,salary和其department_id</strong></p>
<p><strong>方式一：相关子查询</strong></p>
<p><img src="/post/5d2c694a/1554992986225.png" alt="1554992986225"></p>
<p><strong>方式二：在from中使用子查询</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary,e1.department_id</span><br><span class="line"><span class="keyword">FROM</span> employees e1,(<span class="keyword">SELECT</span> department_id,<span class="built_in">AVG</span>(salary) dept_avg_sal <span class="keyword">FROM</span> employees <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id) e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.`department_id` <span class="operator">=</span> e2.department_id</span><br><span class="line"><span class="keyword">AND</span> e2.dept_avg_sal <span class="operator">&lt;</span> e1.`salary`;</span><br></pre></td></tr></table></figure>



<p><strong>题目：查询员工的id,salary,按照department_name 排序</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,salary</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> (</span><br><span class="line">	  <span class="keyword">SELECT</span> department_name</span><br><span class="line">	  <span class="keyword">FROM</span> departments d</span><br><span class="line">	  <span class="keyword">WHERE</span> e.`department_id` <span class="operator">=</span> d.`department_id`</span><br><span class="line">	);</span><br></pre></td></tr></table></figure>



<h3 id="3-4-EXISTS操作符"><a href="#3-4-EXISTS操作符" class="headerlink" title="3.4 EXISTS操作符"></a>3.4 EXISTS操作符</h3><ul>
<li><p>EXISTS 操作符检查在子查询中是否存在满足条件的行</p>
</li>
<li><p><strong>如果在子查询中存在满足条件的行：</strong></p>
<ul>
<li>不在子查询中继续查找</li>
<li>条件返回 TRUE</li>
</ul>
</li>
<li><p><strong>如果在子查询中不存在满足条件的行：</strong></p>
<ul>
<li>条件返回 FALSE</li>
<li>继续在子查询中查找</li>
</ul>
</li>
</ul>
<p><strong>题目：查询公司管理者的employee_id,last_name,job_id,department_id信息</strong></p>
<p>方式一：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id, department_id</span><br><span class="line"><span class="keyword">FROM</span>   employees e1</span><br><span class="line"><span class="keyword">WHERE</span>  <span class="keyword">EXISTS</span> ( <span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">                 <span class="keyword">FROM</span>   employees e2</span><br><span class="line">                 <span class="keyword">WHERE</span>  e2.manager_id <span class="operator">=</span> </span><br><span class="line">                        e1.employee_id);</span><br></pre></td></tr></table></figure>

<p>方式二：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> e1.employee_id, e1.last_name, e1.job_id, e1.department_id</span><br><span class="line"><span class="keyword">FROM</span>   employees e1 <span class="keyword">JOIN</span> employees e2</span><br><span class="line"><span class="keyword">WHERE</span> e1.employee_id <span class="operator">=</span> e2.manager_id;</span><br></pre></td></tr></table></figure>

<p>方式三：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id,last_name,job_id,department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">IN</span> (</span><br><span class="line">		     <span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> manager_id</span><br><span class="line">		     <span class="keyword">FROM</span> employees</span><br><span class="line">		     </span><br><span class="line">		     );</span><br></pre></td></tr></table></figure>



<p><strong>题目：查询departments表中，不存在于employees表中的部门的department_id和department_name</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, department_name</span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;X&#x27;</span></span><br><span class="line">                  <span class="keyword">FROM</span>   employees</span><br><span class="line">                  <span class="keyword">WHERE</span>  department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554993169269.png" alt="1554993169269"></p>
<h3 id="3-5-相关更新"><a href="#3-5-相关更新" class="headerlink" title="3.5 相关更新"></a>3.5 相关更新</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> table1 alias1</span><br><span class="line"><span class="keyword">SET</span>    <span class="keyword">column</span> <span class="operator">=</span> (<span class="keyword">SELECT</span> expression</span><br><span class="line">                 <span class="keyword">FROM</span>   table2 alias2</span><br><span class="line">                 <span class="keyword">WHERE</span>  alias1.column <span class="operator">=</span> alias2.column);</span><br></pre></td></tr></table></figure>

<p>使用相关子查询依据一个表中的数据更新另一个表的数据。</p>
<p>练习：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employees</span><br><span class="line"><span class="keyword">ADD</span>(department_name VARCHAR2(<span class="number">14</span>));</span><br><span class="line"><span class="number">2</span>）</span><br><span class="line"><span class="keyword">UPDATE</span> employees e</span><br><span class="line"><span class="keyword">SET</span>    department_name <span class="operator">=</span>  (<span class="keyword">SELECT</span> department_name </span><br><span class="line">	                       <span class="keyword">FROM</span>   departments d</span><br><span class="line">	                       <span class="keyword">WHERE</span>  e.department_id <span class="operator">=</span> d.department_id);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="3-6-相关删除"><a href="#3-6-相关删除" class="headerlink" title="3.6 相关删除"></a>3.6 相关删除</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table1 alias1</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">column</span> operator (<span class="keyword">SELECT</span> expression</span><br><span class="line">                       <span class="keyword">FROM</span>   table2 alias2</span><br><span class="line">                       <span class="keyword">WHERE</span>  alias1.column <span class="operator">=</span> alias2.column);</span><br></pre></td></tr></table></figure>

<p><strong>使用相关子查询依据一个表中的数据删除另一个表的数据</strong></p>
<p><strong>题目：删除表employees中，其与emp_history表皆有的数据</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">WHERE</span> employee_id <span class="keyword">in</span>  </span><br><span class="line">           (<span class="keyword">SELECT</span> employee_id</span><br><span class="line">            <span class="keyword">FROM</span>   emp_history </span><br><span class="line">            <span class="keyword">WHERE</span>  employee_id <span class="operator">=</span> e.employee_id);</span><br></pre></td></tr></table></figure>

<h3 id="3-7注意事项"><a href="#3-7注意事项" class="headerlink" title="3.7注意事项"></a>3.7注意事项</h3><ol>
<li>单行比较操作符不能用于多行子查询</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#非法使用子查询</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  salary <span class="operator">=</span></span><br><span class="line">                (<span class="keyword">SELECT</span>   <span class="built_in">MIN</span>(salary)</span><br><span class="line">                 <span class="keyword">FROM</span>     employees</span><br><span class="line">                 <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id);</span><br><span class="line">                 </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2.除了在group by 和limit 之外的位置都可以编写子查询</p>
<h2 id="第4章：创建和管理表-—DDL"><a href="#第4章：创建和管理表-—DDL" class="headerlink" title="第4章：创建和管理表 —DDL"></a>第4章：创建和管理表 —DDL</h2><h3 id="4-1-创建和删除数据库"><a href="#4-1-创建和删除数据库" class="headerlink" title="4.1 创建和删除数据库"></a>4.1 创建和删除数据库</h3><ul>
<li>创建一个保存员工信息的数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database employees;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：database不能改名。一些可视化工具可以改名，它是建新库,把所有表复制到新库,再删旧库完成的。</p>
</blockquote>
<ul>
<li>查看当前所有的数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases; </span><br></pre></td></tr></table></figure>

<ul>
<li>使用指定的某个数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名; </span><br></pre></td></tr></table></figure>

<ul>
<li>查看指定库下所有的表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables <span class="keyword">from</span> 数据库名;</span><br></pre></td></tr></table></figure>

<ul>
<li>删除指定的数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database 数据库名;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看当前正在使用的数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATABASE() <span class="keyword">from</span> dual;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：要操作表格和数据之前必须先说明是对哪个数据库进行操作，否则就要对所有对象加上“数据库名.”。</p>
</blockquote>
<h3 id="4-2-标识符命名规则"><a href="#4-2-标识符命名规则" class="headerlink" title="4.2 标识符命名规则"></a>4.2 标识符命名规则</h3><ul>
<li>数据库名不得超过30个字符，变量名限制为29个</li>
<li>必须只能包含 A–Z, a–z, 0–9, _共63个字符</li>
<li>不能在对象名的字符间留空格</li>
<li>必须不能和用户定义的其他对象重名</li>
<li>必须保证你的字段没有和保留字、数据库系统或常用方法冲突</li>
<li>保持字段名和类型的一致性,在命名字段并为其指定数据类型的时候一定要保证一致性。假如数据类型在一个表里是整数,那在另一个表里就不要变成字符型了</li>
</ul>
<h3 id="4-3-常用的数据类型"><a href="#4-3-常用的数据类型" class="headerlink" title="4.3 常用的数据类型"></a>4.3 常用的数据类型</h3><h4 id="4-3-1-MySQL中的数据类型"><a href="#4-3-1-MySQL中的数据类型" class="headerlink" title="4.3.1 MySQL中的数据类型"></a>4.3.1 MySQL中的数据类型</h4><ul>
<li><strong>整型（xxxint）</strong></li>
<li>位类型(bit)</li>
<li><strong>浮点型</strong>（float和double、real）</li>
<li>定点数（decimal,numeric）</li>
<li><strong>日期时间类型</strong>（date,time,datetime,year）</li>
<li><strong>字符串</strong>（char,varchar,xxxtext）</li>
<li>二进制数据（xxxBlob、xxbinary）</li>
<li>枚举（enum）</li>
<li>集合（set）</li>
</ul>
<h4 id="4-3-2-常用数据类型及其范围"><a href="#4-3-2-常用数据类型及其范围" class="headerlink" title="4.3.2 常用数据类型及其范围"></a>4.3.2 常用数据类型及其范围</h4><table>
<thead>
<tr>
<th>数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>INT</td>
<td>从-2^31到2^31-1的整型数据。存储大小为 4个字节</td>
</tr>
<tr>
<td>CHAR(<em>size</em>)</td>
<td>定长字符数据。若未指定，默认为1个字符，最大长度255</td>
</tr>
<tr>
<td>VARCHAR(<em>size</em>)</td>
<td>可变长字符数据，根据字符串实际长度保存，<strong>必须指定长度</strong></td>
</tr>
<tr>
<td>FLOAT(M,D)</td>
<td>单精度，M=整数位+小数位，D=小数位。 D&lt;=M&lt;=255,0&lt;=D&lt;=30，默认M+D&lt;=6</td>
</tr>
<tr>
<td>DOUBLE(M,D)</td>
<td>双精度。D&lt;=M&lt;=255,0&lt;=D&lt;=30，默认M+D&lt;=15</td>
</tr>
<tr>
<td>DATE</td>
<td>日期型数据，格式’YYYY-MM-DD’</td>
</tr>
<tr>
<td>BLOB</td>
<td>二进制形式的长文本数据，最大可达4G</td>
</tr>
<tr>
<td>TEXT</td>
<td>长文本数据，最大可达4G</td>
</tr>
</tbody></table>
<h3 id="4-4-创建表"><a href="#4-4-创建表" class="headerlink" title="4.4 创建表"></a>4.4 创建表</h3><h4 id="4-4-1-创建方式一"><a href="#4-4-1-创建方式一" class="headerlink" title="4.4.1 创建方式一"></a>4.4.1 创建方式一</h4><ul>
<li><strong>必须具备：</strong><ul>
<li>CREATE TABLE权限</li>
<li>存储空间</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [schema.]<span class="keyword">table</span></span><br><span class="line">(<span class="keyword">column</span> datatype [<span class="keyword">DEFAULT</span> expr][, ...]);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>必须指定：</strong><ul>
<li>表名</li>
<li>列名, 数据类型, <strong>尺寸</strong></li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">deptno <span class="type">INT</span>(<span class="number">2</span>),</span><br><span class="line">dname <span class="type">VARCHAR</span>(<span class="number">14</span>),</span><br><span class="line">loc <span class="type">VARCHAR</span>(<span class="number">13</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> dept;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554994890146.png" alt="1554994890146"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--创建表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp (</span><br><span class="line">  <span class="comment">--int类型，自增</span></span><br><span class="line">  emp_id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="comment">--最多保存20个中英文字符</span></span><br><span class="line">  emp_name <span class="type">CHAR</span> (<span class="number">20</span>),</span><br><span class="line">  <span class="comment">--总位数不超过15位</span></span><br><span class="line">  salary <span class="keyword">DOUBLE</span>,</span><br><span class="line">  <span class="comment">--日期类型</span></span><br><span class="line">  birthday <span class="type">DATE</span>,</span><br><span class="line">  <span class="comment">--主键</span></span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (emp_id)</span><br><span class="line">) ;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554997752310.png" alt="1554997752310"></p>
<ul>
<li>查看表的定义：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名;</span><br></pre></td></tr></table></figure>



<h4 id="4-4-2-创建方式二：基于现有的表"><a href="#4-4-2-创建方式二：基于现有的表" class="headerlink" title="4.4.2 创建方式二：基于现有的表"></a>4.4.2 创建方式二：基于现有的表</h4><ul>
<li><p>使用 AS subquery 选项，<strong>将创建表和插入数据结合起来</strong></p>
<p><img src="/post/5d2c694a/1554997882872.png" alt="1554997882872"></p>
</li>
<li><p>指定的列和子查询中的列要一一对应</p>
</li>
<li><p>通过列名和默认值定义列</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> emp2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> employees <span class="keyword">where</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span>; <span class="comment">--创建的emp2是空表</span></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept80</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span>  employee_id, last_name, salary<span class="operator">*</span><span class="number">12</span> ANNSAL, hire_date</span><br><span class="line"><span class="keyword">FROM</span>    employees</span><br><span class="line"><span class="keyword">WHERE</span>   department_id <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> dept80;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554997998148.png" alt="1554997998148"></p>
<p><img src="/post/5d2c694a/1554998004494.png" alt="1554998004494"></p>
<h3 id="4-2-3-复制employees表，不包含任何数据"><a href="#4-2-3-复制employees表，不包含任何数据" class="headerlink" title="4.2.3  复制employees表，不包含任何数据"></a>4.2.3  复制employees表，不包含任何数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> employees_copy_blank</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="4-5-修改表"><a href="#4-5-修改表" class="headerlink" title="4.5 修改表"></a>4.5 修改表</h3><p><strong>使用 ALTER TABLE 语句可以实现：</strong></p>
<ul>
<li><p>向已有的表中添加列</p>
</li>
<li><p>修改现有表中的列</p>
</li>
<li><p>删除现有表中的列</p>
</li>
<li><p>重命名现有表中的列</p>
</li>
</ul>
<h4 id="4-5-1-追加一个列"><a href="#4-5-1-追加一个列" class="headerlink" title="4.5.1 追加一个列"></a>4.5.1 追加一个列</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> dept80 </span><br><span class="line"><span class="keyword">ADD</span> job_id <span class="type">varchar</span>(<span class="number">15</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1554998139815.png" alt="1554998139815"></p>
<h4 id="4-5-2-修改一个列"><a href="#4-5-2-修改一个列" class="headerlink" title="4.5.2 修改一个列"></a>4.5.2 修改一个列</h4><ul>
<li>可以修改列的数据类型, 尺寸和默认值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>	dept80</span><br><span class="line">MODIFY (last_name <span class="type">VARCHAR</span>(<span class="number">30</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>	dept80</span><br><span class="line">MODIFY		(salary <span class="keyword">double</span>(<span class="number">9</span>,<span class="number">2</span>) <span class="keyword">default</span> <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>对默认值的修改只影响今后对表的修改</li>
</ul>
<h4 id="4-5-3-重命名一个列"><a href="#4-5-3-重命名一个列" class="headerlink" title="4.5.3 重命名一个列"></a>4.5.3 重命名一个列</h4><p>使用 CHANGE old_column  new_column  dataType子句重命名列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>  dept80</span><br><span class="line">CHANGE department_name dept_name <span class="type">varchar</span>(<span class="number">15</span>); </span><br></pre></td></tr></table></figure>

<h4 id="4-5-4-删除一个列"><a href="#4-5-4-删除一个列" class="headerlink" title="4.5.4 删除一个列"></a>4.5.4 删除一个列</h4><p>使用 DROP COLUMN 子句删除不再需要的列。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span>  dept80</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">COLUMN</span>  job_id; </span><br></pre></td></tr></table></figure>

<h3 id="4-6-重命名表"><a href="#4-6-重命名表" class="headerlink" title="4.6 重命名表"></a>4.6 重命名表</h3><ul>
<li><p>执行RENAME语句改变表, 视图的名称</p>
<ul>
<li>方式一：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RENAME <span class="keyword">TABLE</span> emp</span><br><span class="line"><span class="keyword">TO</span> myemp;</span><br></pre></td></tr></table></figure>

<ul>
<li>方式二：</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">table</span> dept</span><br><span class="line">RENAME [<span class="keyword">TO</span>] detail_dept;  <span class="comment">-- [TO]可以省略</span></span><br></pre></td></tr></table></figure></li>
<li><p>必须是对象的拥有者</p>
</li>
</ul>
<h3 id="4-7-删除表"><a href="#4-7-删除表" class="headerlink" title="4.7 删除表"></a>4.7 删除表</h3><ul>
<li><p>数据和结构都被删除</p>
</li>
<li><p>所有正在运行的相关事务被提交</p>
</li>
<li><p>所有相关索引被删除</p>
</li>
<li><p>DROP TABLE 语句不能回滚</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> dept80;</span><br></pre></td></tr></table></figure>

<h3 id="4-8-清空表"><a href="#4-8-清空表" class="headerlink" title="4.8 清空表"></a>4.8 清空表</h3><ul>
<li>TRUNCATE TABLE语句:<ul>
<li>删除表中所有的数据</li>
<li>释放表的存储空间</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> detail_dept;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>TRUNCATE语句<strong>不能回滚</strong></p>
</li>
<li><p>可以使用 DELETE 语句删除数据,可以回滚</p>
</li>
<li><p>对比：</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> autocommit <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> emp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2;</span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp2;</span><br></pre></td></tr></table></figure>

<h3 id="4-9注意项"><a href="#4-9注意项" class="headerlink" title="4.9注意项"></a>4.9注意项</h3><ol>
<li><em><strong>TRUNCATE 和 DELETE 区别</strong></em></li>
</ol>
<p>/*<br>对比TRUNCATE TABLE 和 DELETE FROM …<br>结论：TRUNCATE TABLE 一旦操作，就不可以回滚数据<br>      DETELE FROM  支持删除表中的所有数据，可以回滚数据</p>
<p>测试：COMMIT 与 ROLLBACK的使用</p>
<ol>
<li><p>COMMIT:表示提交数据。数据一旦被提交，就不可回滚。<br>ROLLBACK:表示回滚数据。 回滚操作，也只能回滚到最近的一次COMMIT之后。</p>
</li>
<li><p>默认情况下，对数据表的操作(DDL、DML),都是在执行之后，默认提交数据的。</p>
<p>要想测试TRUNCATE TABLE 和 DETELE FROM的区别，需要关闭默认提交的行为：<br>SET autocommit = FALSE; </p>
</li>
</ol>
<p>*/</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myemp</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> myemp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line">#首先测试<span class="keyword">DELETE</span> <span class="keyword">FROM</span> </span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="literal">FALSE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> myemp; #删除数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> myemp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ROLLBACK</span>; #回滚数据</span><br><span class="line"></span><br><span class="line">#接着测试<span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> autocommit <span class="operator">=</span> <span class="literal">FALSE</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">TRUNCATE</span> <span class="keyword">TABLE</span> myemp; #清空表</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> myemp;</span><br><span class="line"></span><br><span class="line">#并没有将数据回滚成功</span><br><span class="line"><span class="keyword">ROLLBACK</span>; #回滚数据</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><em><strong>DROP 和 DELETE 的区别</strong></em></li>
</ol>
<p>删列用drop删内容用delete</p>
<h2 id="第5章：数据库事务"><a href="#第5章：数据库事务" class="headerlink" title="第5章：数据库事务"></a>第5章：数据库事务</h2><h3 id="5-1-什么是事务"><a href="#5-1-什么是事务" class="headerlink" title="5.1 什么是事务"></a>5.1 什么是事务</h3><ul>
<li><p><strong>事务：</strong>一组逻辑操作单元**,**使数据从一种状态变换到另一种状态。</p>
</li>
<li><p>数据库事务由以下的部分组成:</p>
<ul>
<li><strong>一个或多个DML 语句</strong></li>
<li>一个 DDL(Data Definition Language – 数据定义语言) 语句</li>
<li>一个 DCL(Data Control Language – 数据控制语言) 语句</li>
</ul>
</li>
</ul>
<h3 id="5-2-如何处理事务"><a href="#5-2-如何处理事务" class="headerlink" title="5.2 如何处理事务"></a>5.2 如何处理事务</h3><ul>
<li><p><strong>事务处理</strong>（事务操作）：<strong>保证所有事务都作为一个工作单元来执行，即使出现了故障，都不能改变这种执行方式。当在一个事务中执行多个操作时，要么所有的事务都被提交(commit)，那么这些修改就永久地保存下来；要么数据库管理系统将放弃所作的所有修改，整个事务回滚(rollback)到最初状态。</strong></p>
</li>
<li><p>为确保数据库中数据的<strong>一致性</strong>,数据的操纵应当是离散的成组的逻辑单元:当它全部完成时,数据的一致性可以保持,而当这个单元中的一部分操作失败,整个事务应全部视为错误,所有从起始点以后的操作应全部回退到开始状态。 </p>
</li>
<li><p>当一个连接对象被创建时，默认情况下是自动提交事务：每次执行一个SQL 语句时，如果执行成功，就会向数据库自动提交，而不能回滚。</p>
</li>
<li><p><strong>具体过程：</strong></p>
<ol>
<li><strong>设置提交状态：SET AUTOCOMMIT = FALSE;</strong></li>
<li>以第一个 DML 语句的执行作为开始</li>
<li>以下面的其中之一作为结束:<ul>
<li><strong>COMMIT或ROLLBACK语句</strong></li>
<li>DDL 语句（<strong>自动提交</strong>）</li>
<li>用户会话正常结束</li>
<li>系统异常终止</li>
</ul>
</li>
</ol>
</li>
<li><p><strong>COMMIT和ROLLBACK语句的优点</strong></p>
<ul>
<li><strong>确保数据完整性。</strong></li>
<li>数据改变被提交之前预览。</li>
<li>将逻辑上相关的操作分组。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>数据完整性</strong>：</p>
<p>​        存储在数据库中的所有数据值均处于正确的状态。如果数据库中存储有不正确的数据值，则该数据库称为已丧失数据完整性。</p>
<p><strong>数据库采用多种方法来保证数据完整性，包括外键、束约、规则和触发器。</strong></p>
</blockquote>
<ul>
<li><p><strong>提交或回滚前的数据状态</strong></p>
<ul>
<li>改变前的数据状态是可以恢复的</li>
<li>执行 DML 操作的用户可以通过 SELECT 语句查询提交或回滚之前的修正</li>
<li>其他用户不能看到当前用户所做的改变，直到当前用户结束事务。</li>
<li>DML语句所涉及到的行被锁定， 其他用户不能操作。</li>
</ul>
</li>
<li><p><strong>提交后的数据状态</strong></p>
<ul>
<li>数据的改变已经被保存到数据库中。</li>
<li>改变前的数据已经丢失。</li>
<li>所有用户可以看到结果。</li>
<li>锁被释放， 其他用户可以操作涉及到的数据。</li>
</ul>
</li>
<li><p><strong>数据回滚后的状态</strong></p>
<p>使用 ROLLBACK 语句可使数据变化失效：</p>
<ul>
<li><p>数据改变被取消。</p>
</li>
<li><p>修改前的数据状态可以被恢复。</p>
</li>
</ul>
</li>
</ul>
<h3 id="5-3-事务的ACID属性"><a href="#5-3-事务的ACID属性" class="headerlink" title="5.3 事务的ACID属性"></a>5.3 事务的ACID属性</h3><ol>
<li><p><strong>原子性（Atomicity）</strong><br>原子性是指事务是一个不可分割的工作单位，事务中的操作要么都发生，要么都不发生。 </p>
</li>
<li><p><strong>一致性（Consistency）</strong><br>事务必须使数据库从一个一致性状态变换到另外一个一致性状态。</p>
</li>
<li><p><strong>隔离性（Isolation）</strong><br>事务的隔离性是指一个事务的执行不能被其他事务干扰，即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</p>
</li>
<li><p><strong>持久性（Durability）</strong><br>持久性是指一个事务一旦被提交，它对数据库中数据的改变就是永久性的，接下来的其他操作和数据库故障不应该对其有任何影响</p>
</li>
</ol>
<h3 id="5-4-数据库的隔离级别"><a href="#5-4-数据库的隔离级别" class="headerlink" title="5.4 数据库的隔离级别"></a>5.4 数据库的隔离级别</h3><ul>
<li><p>对于同时运行的多个事务, 当这些事务访问数据库中相同的数据时, 如果没有采取必要的隔离机制, 就会导致各种并发问题:</p>
<ul>
<li><strong>脏读</strong>: 对于两个事务 T1, T2, T1 读取了已经被 T2 更新但还<strong>没有被提交</strong>的字段。 之后, 若 T2 回滚, T1读取的内容就是临时且无效的。</li>
<li><strong>不可重复读</strong>: 对于两个事务T1, T2, T1 读取了一个字段, 然后 T2 <strong>更新</strong>了该字段。 之后, T1再次读取同一个字段, 值就不同了。</li>
<li><strong>幻读</strong>: 对于两个事务T1, T2, T1 从一个表中读取了一个字段, 然后 T2 在该表中<strong>插入</strong>了一些新的行。 之后, 如果 T1 再次读取同一个表, 就会多出几行。</li>
</ul>
</li>
<li><p><strong>数据库事务的隔离性</strong>：数据库系统必须具有隔离并发运行各个事务的能力, 使它们不会相互影响, 避免各种并发问题。</p>
</li>
<li><p><strong>一个事务与其他事务隔离的程度称为隔离级别。</strong>数据库规定了多种事务隔离级别, 不同隔离级别对应不同的干扰程度, 隔离级别越高, 数据一致性就越好, 但并发性越弱。</p>
</li>
<li><p><strong>数据库提供的 4 种事务隔离级别：</strong></p>
</li>
</ul>
<p><img src="/post/5d2c694a/1554999608366.png" alt="1554999608366"></p>
<ul>
<li><p>Oracle 支持的 2 种事务隔离级别：<strong>READ COMMITED</strong>, SERIALIZABLE。 Oracle 默认的事务隔离级别为: READ COMMITED 。</p>
</li>
<li><p>Mysql 支持 4 种事务隔离级别。 Mysql 默认的事务隔离级别为: <strong>REPEATABLE READ</strong></p>
</li>
</ul>
<ul>
<li><p><strong>在MySql中设置隔离级别</strong></p>
<ul>
<li>每启动一个 mysql 程序, 就会获得一个单独的数据库连接。每个数据库连接都有一个全局变量 @@tx_isolation, 表示当前的事务隔离级别. </li>
<li>查看当前的隔离级别: <strong>SELECT @@tx_isolation;</strong></li>
<li>查看全局的隔离级别: <strong>SELECT @@global.tx_isolation;</strong></li>
<li>设置当前 mySQL 连接的隔离级别:  </li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> tx_isolation <span class="operator">=</span><span class="string">&#x27;repeatable-read&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置数据库系统的全局的隔离级别:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> tx_isolation <span class="operator">=</span><span class="string">&#x27;read-committed&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：这里的隔离级别中间是减号，不是下划线。</p>
</blockquote>
</li>
</ul>
<h2 id="第6章：数据处理之增删改"><a href="#第6章：数据处理之增删改" class="headerlink" title="第6章：数据处理之增删改"></a>第6章：数据处理之增删改</h2><h3 id="6-1-插入数据"><a href="#6-1-插入数据" class="headerlink" title="6.1 插入数据"></a>6.1 插入数据</h3><p><img src="/post/5d2c694a/1555425366064.png" alt="1555425366064"></p>
<ul>
<li>使用 INSERT 语句向表中插入数据。</li>
</ul>
<p><img src="/post/5d2c694a/1555425425657.png" alt="1555425425657"></p>
<ul>
<li>使用这种语法一次只能向表中插入<strong>一条</strong>数据。</li>
<li>为每一列添加一个新值。</li>
<li>按列的默认顺序列出各个列的值。 </li>
<li>在 INSERT 子句中随意列出列名和他们的值。</li>
<li>VALUES也可以写成VALUE，但是VALUES是标准写法。</li>
<li><strong>字符和日期型数据应包含在单引号中</strong>。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments(department_id, department_name, </span><br><span class="line">                        manager_id, location_id)</span><br><span class="line"><span class="keyword">VALUES</span>      (<span class="number">70</span>, <span class="string">&#x27;Pub&#x27;</span>, <span class="number">100</span>, <span class="number">1700</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>向表中插入空值</strong></p>
<ul>
<li>隐式方式：在列名表中省略该列的值。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>	departments (department_id,department_name )</span><br><span class="line"><span class="keyword">VALUES</span> (<span class="number">30</span>, <span class="string">&#x27;Purchasing&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>显示方式：在VALUES 子句中指定空值。 </li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span>	departments</span><br><span class="line"><span class="keyword">VALUES</span>		(<span class="number">100</span>, <span class="string">&#x27;Finance&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>同时插入多行数据</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp(NAME)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;Tom&#x27;</span>),(<span class="string">&#x27;Jerry&#x27;</span>),(<span class="string">&#x27;Rose&#x27;</span>);</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>从其它表中拷贝数据</strong><ul>
<li>在 INSERT 语句中加入子查询。 </li>
<li><strong>不必书写</strong> <strong>VALUES</strong> <strong>子句。</strong> </li>
<li>子查询中的值列表应与 INSERT 子句中的列名对应。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp2 </span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales_reps(id, name, salary, commission_pct)</span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, salary, commission_pct</span><br><span class="line"><span class="keyword">FROM</span>   employees</span><br><span class="line"><span class="keyword">WHERE</span>  job_id <span class="keyword">LIKE</span> <span class="string">&#x27;%REP%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-更新数据"><a href="#6-2-更新数据" class="headerlink" title="6.2 更新数据"></a>6.2 更新数据</h3><p><img src="/post/5d2c694a/1555425824246.png" alt="1555425824246"></p>
<ul>
<li>使用 UPDATE 语句更新数据。</li>
</ul>
<p><img src="/post/5d2c694a/1555425924844.png" alt="1555425924844"></p>
<ul>
<li><p>可以一次更新<strong>多条</strong>数据。</p>
</li>
<li><p>如果需要回滚数据，需要保证在DML前，进行设置：<strong>SET AUTOCOMMIT = FALSE;</strong></p>
</li>
</ul>
<hr>
<ul>
<li>使用 <strong>WHERE</strong> 子句指定需要更新的数据。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span>    department_id <span class="operator">=</span> <span class="number">70</span></span><br><span class="line"><span class="keyword">WHERE</span>  employee_id <span class="operator">=</span> <span class="number">113</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果省略 WHERE 子句，则表中的所有数据都将被更新。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> 	copy_emp</span><br><span class="line"><span class="keyword">SET</span>    	department_id <span class="operator">=</span> <span class="number">110</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>更新中的数据完整性错误</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> employees</span><br><span class="line"><span class="keyword">SET</span>    department_id <span class="operator">=</span> <span class="number">55</span></span><br><span class="line"><span class="keyword">WHERE</span>  department_id <span class="operator">=</span> <span class="number">110</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1555426069578.png" alt="1555426069578"></p>
<blockquote>
<p>说明：不存在 55 号部门</p>
</blockquote>
<h3 id="6-3-删除数据"><a href="#6-3-删除数据" class="headerlink" title="6.3 删除数据"></a>6.3 删除数据</h3><p><img src="/post/5d2c694a/1555426124751.png" alt="1555426124751"></p>
<ul>
<li>使用 DELETE 语句从表中删除数据</li>
</ul>
<p><img src="/post/5d2c694a/1555426162264.png" alt="1555426162264"></p>
<ul>
<li>使用 WHERE 子句删除指定的记录。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span>  department_name <span class="operator">=</span> <span class="string">&#x27;Finance&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>如果省略 WHERE 子句，则表中的全部数据将被删除</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span>  copy_emp;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>删除中的数据完整性错误</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">WHERE</span>       department_id <span class="operator">=</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1555426258516.png" alt="1555426258516"></p>
<blockquote>
<p>说明：You cannot delete a row that contains a primary key that is used as a foreign key in another table.</p>
</blockquote>
<h2 id="第7章：约束-constraint"><a href="#第7章：约束-constraint" class="headerlink" title="第7章：约束(constraint)"></a>第7章：约束(constraint)</h2><h3 id="7-1-什么是约束"><a href="#7-1-什么是约束" class="headerlink" title="7.1 什么是约束"></a>7.1 什么是约束</h3><ul>
<li>为了保证数据的一致性和完整性，SQL规范以约束的方式对<strong>表数据进行额外的条件限制</strong>。<ul>
<li>实体完整性（Entity Integrity）：例如，同一个表中，不能存在两条完全相同无法区分的记录</li>
<li>域完整性（Domain Integrity）：例如：年龄范围0-120，性别范围“男/女”</li>
<li>引用完整性（Referential Integrity）：例如：员工所在部门，在部门表中要能找到这个部门</li>
<li>用户自定义完整性（User-defined Integrity）：例如：用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。</li>
</ul>
</li>
<li>约束是表级的强制规定</li>
<li>可以在<strong>创建表时规定约束（通过 CREATE TABLE 语句）</strong>，或者在<strong>表创建之后也可以（通过 ALTER TABLE 语句）</strong></li>
<li><strong>根据约束数据列的限制，</strong>约束可分为：<ul>
<li><strong>单列约束</strong>：每个约束只约束一列</li>
<li><strong>多列约束</strong>：每个约束可约束多列数据</li>
</ul>
</li>
<li><strong>根据约束的作用范围</strong>，约束可分为：<ul>
<li><strong>列级约束</strong>：只能作用在一个列上，跟在列的定义后面</li>
<li><strong>表级约束</strong>：可以作用在多个列上，不与列一起，而是单独定义</li>
</ul>
</li>
<li><strong>根据约束起的作用</strong>，约束可分为：<ul>
<li><strong>NOT NULL</strong> <strong>非空约束，规定某个字段不能为空</strong></li>
<li><strong>UNIQUE</strong>  <strong>唯一约束</strong>，<strong>规定某个字段在整个表中是唯一的</strong></li>
<li><strong>PRIMARY KEY  主键(非空且唯一)约束</strong></li>
<li><strong>FOREIGN KEY</strong>  <strong>外键约束</strong></li>
<li><strong>CHECK</strong>  <strong>检查约束</strong></li>
<li><strong>DEFAULT</strong>  <strong>默认值约束</strong></li>
</ul>
</li>
</ul>
<blockquote>
<p>注意： MySQL不支持check约束，但可以使用check约束，而没有任何效果</p>
</blockquote>
<ul>
<li>查看某个表已有的约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information_schema.table_constraints </span><br><span class="line"><span class="keyword">WHERE</span> table_name <span class="operator">=</span> <span class="string">&#x27;employees&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="7-2-NOT-NULL约束"><a href="#7-2-NOT-NULL约束" class="headerlink" title="7.2 NOT NULL约束"></a>7.2 NOT NULL约束</h3><ul>
<li>not null：<strong>保证列值不能为空</strong></li>
</ul>
<p><img src="/post/5d2c694a/1555426972098.png" alt="1555426972098"></p>
<ul>
<li><p>非空约束用于确保当前列的值不为空值，非空约束只能出现在表对象的列上。</p>
</li>
<li><p>Null类型特征：</p>
<ul>
<li>所有的类型的值都可以是null，包括int、float等数据类型</li>
<li>空字符串’’不等于null，0也不等于null</li>
</ul>
</li>
<li><p><strong>创建 not null 约束</strong></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">id <span class="type">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;abc&#x27;</span>,</span><br><span class="line">sex <span class="type">CHAR</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>增加 not null 约束</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line">MODIFY sex <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>取消 not null 约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line">MODIFY sex <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>取消 not null 约束，增加默认值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line">MODIFY NAME <span class="type">VARCHAR</span>(<span class="number">15</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;abc&#x27;</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-UNIQUE约束"><a href="#7-3-UNIQUE约束" class="headerlink" title="7.3 UNIQUE约束"></a>7.3 UNIQUE约束</h3><p><img src="/post/5d2c694a/1555427198811.png" alt="1555427198811"></p>
<ul>
<li><p>同一个表可以有多个唯一约束。</p>
</li>
<li><p>唯一约束可以是某一个列的值唯一，也可以多个列组合的值唯一。</p>
</li>
<li><p>在创建唯一约束的时候，如果不给唯一约束名称，就默认和列名相同。</p>
</li>
<li><p><strong>MySQL会给唯一约束的列上默认创建一个唯一索引。</strong></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t_course(</span><br><span class="line">	cid <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">	cname <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">UNIQUE</span>,</span><br><span class="line">	description <span class="type">VARCHAR</span>(<span class="number">200</span>)</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span>(</span><br><span class="line"> id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> NAME <span class="type">VARCHAR</span>(<span class="number">25</span>),</span><br><span class="line"> PASSWORD <span class="type">VARCHAR</span>(<span class="number">16</span>),</span><br><span class="line"> <span class="comment">--使用表级约束语法</span></span><br><span class="line"> <span class="keyword">CONSTRAINT</span> uk_name_pwd <span class="keyword">UNIQUE</span>(NAME,PASSWORD)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>表示用户名和密码组合不能重复</p>
</blockquote>
<ul>
<li>添加唯一约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> </span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">UNIQUE</span>(NAME,PASSWORD);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> </span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> uk_name_pwd <span class="keyword">UNIQUE</span>(NAME,PASSWORD);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> </span><br><span class="line">MODIFY NAME <span class="type">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">UNIQUE</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>删除约束</p>
<ul>
<li>删除唯一约束只能通过删除唯一索引的方式删除。</li>
<li>删除时需要指定唯一索引名，唯一索引名就和唯一约束名一样。</li>
<li>如果创建唯一约束时未指定名称，如果是单列，就默认和列名相同，如果是组合列，那么默认和()中排在第一个的列名相同。也可以自定义唯一性约束名。</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">USER</span> </span><br><span class="line"><span class="keyword">DROP</span> INDEX uk_name_pwd;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果忘记名称，可以通过“**<code>show index from 表名称</code>;**”查看。</p>
</blockquote>
<h3 id="7-3-1注意关于null"><a href="#7-3-1注意关于null" class="headerlink" title="7.3.1注意关于null"></a>7.3.1注意关于null</h3><p>声明为unique约束的字段，在添加或修改数据时，允许多次设置为null</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#<span class="number">2.</span> <span class="keyword">unique</span>: 唯一性约束</span><br><span class="line"># 创建表的同时，添加约束</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  emp4(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">UNIQUE</span>, #列级约束</span><br><span class="line">last_name <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">email <span class="type">VARCHAR</span>(<span class="number">25</span>),</span><br><span class="line">hire_date <span class="type">DATE</span>,</span><br><span class="line">#表级约束</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp4_email_uk <span class="keyword">UNIQUE</span>(email)</span><br><span class="line">);</span><br><span class="line">#添加成功</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp4(id,last_name,email,hire_date)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">&#x27;Tom1&#x27;</span>,<span class="keyword">NULL</span>,CURDATE());</span><br><span class="line"></span><br><span class="line">#添加成功</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emp4(id,last_name,email,hire_date)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="string">&#x27;Tom1&#x27;</span>,<span class="keyword">NULL</span>,CURDATE());</span><br></pre></td></tr></table></figure>



<h3 id="7-4-PRIMARY-KEY-约束"><a href="#7-4-PRIMARY-KEY-约束" class="headerlink" title="7.4 PRIMARY KEY 约束"></a>7.4 PRIMARY KEY 约束</h3><p><img src="/post/5d2c694a/1555427492244.png" alt="1555427492244"></p>
<ul>
<li><p>主键约束相当于<strong>唯一约束+非空约束的组合</strong>，主键约束列不允许重复，也不允许出现空值</p>
</li>
<li><p>如果是多列组合的主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</p>
</li>
<li><p><strong>每个表最多只允许一个主键</strong>，建立主键约束可以在列级别创建，也可以在表级别上创建。</p>
</li>
<li><p><strong>MySQL的主键名总是PRIMARY</strong>，就算自己命名了主键约束名也没用。</p>
</li>
<li><p>当创建主键约束时，系统默认会在所在的列和列组合上建立对应的<strong>主键索引</strong>。删除主键时，也会直接删除主键索引。</p>
<ul>
<li>列级模式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp4(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT ,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>表级模式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp5(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">pwd <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp5_id_pk <span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>组合模式</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp6(</span><br><span class="line">id <span class="type">INT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">pwd <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp7_pk <span class="keyword">PRIMARY</span> KEY(NAME,pwd)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li><p>删除主键约束</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：删除主键约束，不需要指定主键名，因为一个表只有一个主键，删除主键约束后，非空还存在。</p>
</blockquote>
<ul>
<li>添加主键约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">PRIMARY</span> KEY(NAME,pwd);</span><br></pre></td></tr></table></figure>

<ul>
<li>修改主键约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp5</span><br><span class="line">MODIFY id <span class="type">INT</span> <span class="keyword">PRIMARY</span> KEY;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>补充：关于自增长auto_increment的使用</strong><ul>
<li>整数类型的字段才可以设置自增长</li>
<li>当需要产生唯一标识符或顺序值时，可设置自增长</li>
<li><strong>一个表最多只能有一个自增长列</strong></li>
<li>自增长列必须非空（已经隐式满足了）</li>
<li><strong>自增长列必须声明有主键约束或唯一性约束</strong></li>
<li>InnoDB表的自动增长列可以手动插入，但是插入的值如果是空或者0，则实际插入的将是自动增长后的值。</li>
</ul>
</li>
</ul>
<h3 id="7-5-FOREIGN-KEY-约束"><a href="#7-5-FOREIGN-KEY-约束" class="headerlink" title="7.5 FOREIGN KEY 约束"></a>7.5 FOREIGN KEY 约束</h3><p><img src="/post/5d2c694a/1555428214706.png" alt="1555428214706"></p>
<ul>
<li><p><strong>基本理解：</strong></p>
<ul>
<li>外键约束是保证一个或两个表之间的参照完整性，外键是构建于一个表的两个字段或是两个表的两个字段之间的参照关系</li>
<li>同一个表可以有多个外键约束</li>
<li>从表的外键值必须在主表中能找到或者为空。当主表的记录被从表参照时，主表的记录将不允许删除，如果要删除数据，需要先删除从表中依赖该记录的数据，然后才可以删除主表的数据</li>
<li><strong>注意：外键约束的参照列，在主表中引用的只能是主键或唯一键约束的列</strong></li>
<li>从表的外键列与主表被参照的列名字可以不相同，但是数据类型必须一样</li>
<li>在实际开发中，不建议在创建表时使用外键约束。</li>
<li>如何查看-&gt;在左边employees表中右键-&gt;外键</li>
</ul>
</li>
<li><p><strong>注意点：</strong></p>
<ul>
<li>在创建外键约束时，如果不给外键约束名称，<strong>默认名不是列名，而是自动产生一个外键名</strong>（例如 student_ibfk_1;），也可以指定外键约束名。</li>
<li><strong>当创建外键约束时，系统默认会在所在的列上建立对应的普通索引</strong>。但是索引名是列名，不是外键的约束名。</li>
<li><strong>删除外键时，关于外键列上的普通索引需要单独删除</strong>。</li>
<li>还有一种就是级联删除子表数据。</li>
</ul>
</li>
<li><p><strong>创建外键约束</strong></p>
<ul>
<li>主表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> dept(</span><br><span class="line">dept_id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">dept_name <span class="type">VARCHAR</span>(<span class="number">20</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>从表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> emp(</span><br><span class="line">emp_id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">last_name <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">dept_id <span class="type">INT</span>,</span><br><span class="line"><span class="keyword">CONSTRAINT</span> emp_dept_id_fk <span class="keyword">FOREIGN</span> KEY(dept_id) </span><br><span class="line"><span class="keyword">REFERENCES</span> dept(dept_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>– FOREIGN KEY: 在表级指定子表中的列</p>
<p>– REFERENCES: 标示在父表中的列</p>
</blockquote>
</li>
<li><p><strong>创建多列外键组合，必须使用表级约束</strong></p>
<ul>
<li>主表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> classes(</span><br><span class="line">id <span class="type">INT</span>,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">number <span class="type">INT</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY(NAME,number)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>从表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student(</span><br><span class="line">id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">classes_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">classes_number <span class="type">INT</span>,</span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(classes_name,classes_number) </span><br><span class="line"><span class="keyword">REFERENCES</span> classes(NAME,number)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li><p>删除外键约束</p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> KEY emp_dept_id_fk;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：外键列上的索引，需要单独删除。比如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名称 <span class="keyword">DROP</span> INDEX 外键列索引名; </span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_emp <span class="keyword">DROP</span> INDEX dept_id; <span class="comment">-- 举例</span></span><br></pre></td></tr></table></figure>

<p>查看索引名：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> 表名称;</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>增加外键约束</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> emp</span><br><span class="line"><span class="keyword">ADD</span> [<span class="keyword">CONSTRAINT</span> emp_dept_id_fk] <span class="keyword">FOREIGN</span> KEY(dept_id) </span><br><span class="line"><span class="keyword">REFERENCES</span> dept(dept_id);</span><br></pre></td></tr></table></figure>

<ul>
<li>关于删除操作：级联删除与级联置空<ul>
<li><strong>ON DELETE CASCADE(级联删除)</strong>: 当父表中的列被删除时，子表中相对应的列也被删除</li>
<li><strong>ON DELETE SET NULL(级联置空)</strong>: 当父表中的列被删除时，子表中相应的列的值置空</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student( </span><br><span class="line">id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">classes_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">classes_number <span class="type">INT</span>, </span><br><span class="line"><span class="comment">/*表级别联合外键*/</span> </span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(classes_name, classes_number) </span><br><span class="line"><span class="keyword">REFERENCES</span> classes(NAME, number) <span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE);</span><br></pre></td></tr></table></figure>

<ul>
<li>关于修改操作：级联修改与级联置空<ul>
<li><strong>ON UPDATE CASCADE(级联修改)：</strong>当父表中的列值由a修改为b时，子表中相对应的列值为a的改为值b</li>
<li><strong>ON UPDATE SET NULL(级联置空)：</strong>子表中相应的列的值置空</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> student( </span><br><span class="line">id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>), </span><br><span class="line">classes_name <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">classes_number <span class="type">INT</span>, </span><br><span class="line"><span class="comment">/*表级别联合外键*/</span> </span><br><span class="line"><span class="keyword">FOREIGN</span> KEY(classes_name, classes_number) </span><br><span class="line"><span class="keyword">REFERENCES</span> classes(NAME, number) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE);</span><br></pre></td></tr></table></figure>



<h3 id="7-6-CHECK-约束"><a href="#7-6-CHECK-约束" class="headerlink" title="7.6 CHECK 约束"></a>7.6 CHECK 约束</h3><ul>
<li>MySQL可以使用check约束，但check约束对数据验证没有任何作用,添加数据时，没有任何错误或警告</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> temp(</span><br><span class="line">id <span class="type">INT</span> AUTO_INCREMENT,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">age <span class="type">INT</span> <span class="keyword">CHECK</span>(age <span class="operator">&gt;</span> <span class="number">20</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="7-7-DEFAULT约束"><a href="#7-7-DEFAULT约束" class="headerlink" title="7.7 DEFAULT约束"></a>7.7 DEFAULT约束</h3><ul>
<li>一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默认值。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> myemp(</span><br><span class="line">id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">NAME <span class="type">VARCHAR</span>(<span class="number">15</span>),</span><br><span class="line">salary <span class="keyword">DOUBLE</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="number">2000</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="第8章：其它数据库对象"><a href="#第8章：其它数据库对象" class="headerlink" title="第8章：其它数据库对象"></a>第8章：其它数据库对象</h2><h3 id="8-1-常见的数据库对象"><a href="#8-1-常见的数据库对象" class="headerlink" title="8.1 常见的数据库对象"></a>8.1 常见的数据库对象</h3><table>
<thead>
<tr>
<th>对象</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>表(TABLE)</td>
<td><strong>基本的数据存储集合，由行和列组成</strong></td>
</tr>
<tr>
<td>视图(VIEW)</td>
<td><strong>从表中抽出的逻辑上相关的数据集合</strong></td>
</tr>
<tr>
<td>序列(SEQUENCE)</td>
<td><strong>提供有规律的数值。</strong></td>
</tr>
<tr>
<td>索引(INDEX)</td>
<td><strong>提高查询的效率</strong></td>
</tr>
<tr>
<td>同义词(SYNONYM)</td>
<td><strong>给对象起别名</strong></td>
</tr>
</tbody></table>
<h3 id="8-2-视图（VIEW）"><a href="#8-2-视图（VIEW）" class="headerlink" title="8.2 视图（VIEW）"></a>8.2 视图（VIEW）</h3><p><img src="/post/5d2c694a/1555430281798.png" alt="1555430281798"></p>
<ul>
<li><p>视图是一种虚表</p>
</li>
<li><p><strong>视图建立在已有表的基础上</strong>, 视图赖以建立的这些表称为<strong>基表</strong></p>
</li>
<li><p>向视图提供数据内容的语句为 SELECT 语句, 可以将视图理解为<strong>存储起来的</strong> <strong>SELECT</strong> <strong>语句</strong> </p>
</li>
<li><p>视图向用户提供基表数据的另一种表现形式</p>
</li>
<li><p>为什么使用视图？</p>
<ul>
<li>控制数据访问</li>
<li><strong>简化查询</strong></li>
<li>避免重复访问相同的数据</li>
</ul>
</li>
<li><p>简单视图和复杂视图</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>特性</th>
<th>简单视图</th>
<th>复杂视图</th>
</tr>
</thead>
<tbody><tr>
<td>表的数量</td>
<td>一个</td>
<td>一个或多个</td>
</tr>
<tr>
<td>函数</td>
<td>没有</td>
<td>有</td>
</tr>
<tr>
<td>分组</td>
<td>没有</td>
<td>有</td>
</tr>
<tr>
<td>DML操作</td>
<td>可以</td>
<td>有时可以</td>
</tr>
</tbody></table>
<ul>
<li><p>创建视图</p>
<ul>
<li><strong>在</strong> <strong>CREATE VIEW</strong> <strong>语句中嵌入子查询</strong></li>
</ul>
<p><img src="/post/5d2c694a/1555430474587.png" alt="1555430474587"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> 	empvu80</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span>  employee_id, last_name, salary</span><br><span class="line"><span class="keyword">FROM</span>    employees</span><br><span class="line"><span class="keyword">WHERE</span>   department_id <span class="operator">=</span> <span class="number">80</span>;</span><br></pre></td></tr></table></figure>



<ul>
<li>子查询可以是复杂的 SELECT 语句</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> replace <span class="keyword">view</span> empview </span><br><span class="line"><span class="keyword">as</span> </span><br><span class="line"><span class="keyword">select</span> employee_id emp_id,last_name name,department_name</span><br><span class="line"><span class="keyword">from</span> employees e,departments d</span><br><span class="line"><span class="keyword">Where</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure></li>
<li><p>创建视图时在子查询中给列定义<strong>别名</strong></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> salvu50</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span>  employee_id ID_NUMBER, last_name NAME,salary<span class="operator">*</span><span class="number">12</span> ANN_SALARY</span><br><span class="line"><span class="keyword">FROM</span>    employees</span><br><span class="line"><span class="keyword">WHERE</span>   department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>描述视图结构</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> empvu80;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：在选择视图中的列时应使用别名</p>
</blockquote>
<ul>
<li>查询视图</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span>	salvu80;</span><br></pre></td></tr></table></figure>

<p><img src="/post/5d2c694a/1555430882363.png" alt="1555430882363"></p>
<ul>
<li><strong>修改视图</strong><ul>
<li>使用CREATE <strong>OR REPLACE</strong> VIEW 子句<strong>修改视图</strong></li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> empvu80</span><br><span class="line">(id_number, name, sal, department_id)</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span>  employee_id, first_name <span class="operator">||</span> <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> last_name, salary, department_id</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">80</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：CREATE VIEW 子句中各列的别名应和子查询中各列相对应。</p>
</blockquote>
<ul>
<li><strong>创建复杂视图</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span>	dept_sum_vu</span><br><span class="line">(name, minsal, maxsal, avgsal)</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> d.department_name, <span class="built_in">MIN</span>(e.salary), <span class="built_in">MAX</span>(e.salary),<span class="built_in">AVG</span>(e.salary)</span><br><span class="line"><span class="keyword">FROM</span> employees e, departments d</span><br><span class="line"><span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>  d.department_name;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>视图中使用DML的规定</strong></p>
<ul>
<li><p>可以在简单视图中使用DML操作</p>
</li>
<li><p>当视图定义中包含以下元素之一时不能使用delete:</p>
<ul>
<li>组函数</li>
<li>GROUP BY 子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪列</li>
</ul>
</li>
<li><p>当视图定义中包含以下元素之一时不能使用update:</p>
<ul>
<li>组函数</li>
<li>GROUP BY子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪列</li>
<li>列的定义为表达式</li>
</ul>
</li>
<li><p>当视图定义中包含以下元素之一时不能使用insert:</p>
<ul>
<li>组函数</li>
<li>GROUP BY 子句</li>
<li>DISTINCT 关键字</li>
<li>ROWNUM 伪列</li>
<li>列的定义为表达式</li>
<li>表中非空的列在视图定义中未包括</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>删除视图</strong></p>
<p>删除视图只是删除视图的定义，并不会删除基表的数据。</p>
<p><img src="/post/5d2c694a/1555431350101.png" alt="1555431350101"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> empvu80;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="8-3-索引（INDEX）"><a href="#8-3-索引（INDEX）" class="headerlink" title="8.3 索引（INDEX）"></a>8.3 索引（INDEX）</h3><h4 id="8-3-1-基本介绍"><a href="#8-3-1-基本介绍" class="headerlink" title="8.3.1 基本介绍"></a>8.3.1 基本介绍</h4><ul>
<li>一种独立于表的模式对象, 可以存储在与表不同的磁盘或表空间中，<strong>是一个单独的、物理的数据库结构</strong></li>
<li>索引被删除或损坏, 不会对表产生影响, 其影响的只是<strong>查询的速度</strong></li>
<li>索引一旦建立, 数据库管理系统会对其进行自动维护, 而且由数据库管理系统决定何时使用索引。用户不用在查询语句中指定使用哪个索引</li>
<li>在删除一个表时,所有基于该表的索引会自动被删除</li>
<li>通过指针加速数据库服务器的查询速度</li>
<li><strong>通过快速定位数据的方法，减少磁盘</strong> <strong>I/O</strong></li>
</ul>
<h4 id="8-3-2-索引的介绍"><a href="#8-3-2-索引的介绍" class="headerlink" title="8.3.2 索引的介绍"></a>8.3.2 索引的介绍</h4><p>例如：一本字典，如何快速找到某个字，可以给字典加目录，对数据库来说,索引的作用即是给”数据”加目录。</p>
<p>设有N条随机记录,不用索引,平均查找N/2次,那么用了索引之后呢。如果是btree(二叉树)索引， 则是logN。                                        如果是hash(哈希)索引，时间复杂度是1。</p>
<ul>
<li><p>MySQL提供多种索引类型供选择：</p>
<ul>
<li>普通索引</li>
<li>唯一性索引</li>
<li>主键索引：只有一个主键索引</li>
<li>全文索引：MySQL5.X版本只有MyISAM存储引擎支持FULLTEXT，并且只限于CHAR、VARCHAR和TEXT类型的列上创建。</li>
</ul>
</li>
<li><p><strong>MySQL的索引方法：</strong></p>
<ul>
<li>HASH</li>
<li>BTREE（MySQL中多数索引都以BTREE的形式保存。）</li>
</ul>
</li>
</ul>
<h4 id="8-3-3-创建索引"><a href="#8-3-3-创建索引" class="headerlink" title="8.3.3 创建索引"></a>8.3.3 创建索引</h4><ul>
<li><p><strong>自动创建</strong>: 在定义 PRIMARY KEY 或 UNIQUE 约束后系统自动在相应的列上创建<strong>唯一性</strong>索引</p>
</li>
<li><p><strong>手动创建</strong>: 用户可以在其它列上创建非唯一的索引，以加速查询</p>
</li>
<li><p>在一个或多个列上创建索引</p>
</li>
</ul>
<p><img src="/post/5d2c694a/1555431521865.png" alt="1555431521865"></p>
<ul>
<li>在表 EMPLOYEES的列 LAST_NAME 上创建索引</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX 	emp_last_name_idx</span><br><span class="line"><span class="keyword">ON</span> 		employees(last_name);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>索引的优缺点</strong></p>
<ul>
<li>索引的优点：加快了查询速度(select )</li>
<li>索引的缺点：降低了增,删,改的速度(update/delete/insert)，增大了表的文件大小(索引文件甚至可能比数据文件还大)</li>
</ul>
</li>
<li><p><strong>什么时候创建索引</strong></p>
<p>以下情况可以创建索引:</p>
<ul>
<li><p>列中数据值分布范围很广</p>
</li>
<li><p>列经常在 WHERE 子句或连接条件中出现</p>
</li>
<li><p>表经常被访问而且数据量很大 ，访问的数据大概占数据总量的2%到4%</p>
</li>
</ul>
</li>
<li><p><strong>什么时候不要创建索引</strong></p>
<p>下列情况不要创建索引:</p>
<ul>
<li>表很小</li>
<li>列不经常作为连接条件或出现在WHERE子句中</li>
<li>查询的数据大于2%到4%</li>
<li>表经常更新</li>
<li>索引散列值,过于集中的值不要索引，例如:给性别”男”,”女”加索引,意义不大</li>
</ul>
</li>
</ul>
<blockquote>
<p>索引不需要用，只是说我们在用name进行查询的时候，速度会更快。当然查的速度快了，插入的速度就会慢。因为插入数据的同时，还需要维护一个索引。</p>
</blockquote>
<h4 id="8-3-4-删除索引"><a href="#8-3-4-删除索引" class="headerlink" title="8.3.4 删除索引"></a>8.3.4 删除索引</h4><ul>
<li>使用DROP INDEX 命令删除索引</li>
</ul>
<p><img src="/post/5d2c694a/1555432228122.png" alt="1555432228122"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX upper_last_name_idx</span><br><span class="line"><span class="keyword">ON</span> uppers;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>只有索引的拥有者或拥有DROP ANY INDEX 权限的用户才可以删除索引</p>
</li>
<li><p>删除操作是不可回滚的</p>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://wh1720848796.github.io">Yincha</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://wh1720848796.github.io/post/5d2c694a.html">http://wh1720848796.github.io/post/5d2c694a.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://wh1720848796.github.io" target="_blank">饮茶</a>！</span></div></div><div class="tag_share"><div class="post_share"><div class="social-share" data-image="/img/HatsuneMiku6.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/571c6a07.html" title="MyBatis逆向工程"><img class="cover" src="/img/HatsuneMiku5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MyBatis逆向工程</div></div></a></div><div class="next-post pull-right"><a href="/post/f8615f0.html" title="附录B 更多关于IPython的内容（完）"><img class="cover" src="/img/HatsuneMiku2.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">附录B 更多关于IPython的内容（完）</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/EmiyaShirou.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Yincha</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">26</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/wh1720848796" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://gitee.com/wwhhbs" target="_blank" title="Gitee"><i class="fab fa-git" style="color: #EE2C2C;"></i></a><a class="social-icon" href="mailto:1720848796@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">微信:wh13782 QQ:1720848796</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SQL%E5%BC%80%E5%8F%91"><span class="toc-text">SQL开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0%EF%BC%9ASQL%E6%A6%82%E8%BF%B0"><span class="toc-text">第1章：SQL概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SQL%E7%9A%84%E8%AF%AD%E8%A8%80%E8%A7%84%E8%8C%83"><span class="toc-text">1. SQL的语言规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-text">2. 命名规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SQL%E5%88%86%E7%B1%BB"><span class="toc-text">3. SQL分类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E6%9F%A5%E8%AF%A2"><span class="toc-text">第2章：数据处理之查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9F%BA%E6%9C%AC%E7%9A%84SELECT%E8%AF%AD%E5%8F%A5"><span class="toc-text">2.1 基本的SELECT语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-SELECT-%E2%80%A6-FROM"><span class="toc-text">2.1.1 SELECT … FROM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E5%88%97%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-text">2.1.2 列的别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E5%8E%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E8%A1%8C"><span class="toc-text">2.1.3 去除重复行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E7%A9%BA%E5%80%BC%E5%8F%82%E4%B8%8E%E8%BF%90%E7%AE%97"><span class="toc-text">2.1.4 空值参与运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-5-%E6%98%BE%E7%A4%BA%E8%A1%A8%E7%BB%93%E6%9E%84"><span class="toc-text">2.1.5 显示表结构</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%BF%87%E6%BB%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">2.2 过滤数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-SELECT-%E2%80%A6-FROM-%E2%80%A6-WHERE"><span class="toc-text">2.2.1 SELECT … FROM … WHERE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">2.2.2 比较运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">① 基本操作符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E5%85%B6%E5%AE%83%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">② 其它比较运算符</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">2.2.3 逻辑运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">2.2.4 算术运算符</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%92%8C%E5%88%86%E9%A1%B5"><span class="toc-text">2.3  排序数据和分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E6%8E%92%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="toc-text">2.3.1 排序数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E5%88%86%E9%A1%B5"><span class="toc-text">2.3.2 分页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.4 多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E7%AC%9B%E5%8D%A1%E5%B0%94%E7%A7%AF%E9%94%99%E8%AF%AF"><span class="toc-text">2.4.1 笛卡尔积错误</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E5%88%86%E7%B1%BB1%EF%BC%9A%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.4.2 分类1：等值连接 vs 非等值连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-text">① 等值连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E9%9D%9E%E7%AD%89%E5%80%BC%E8%BF%9E%E6%8E%A5"><span class="toc-text">② 非等值连接</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E5%88%86%E7%B1%BB2%EF%BC%9A%E8%87%AA%E8%BF%9E%E6%8E%A5-vs-%E9%9D%9E%E8%87%AA%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.4.3 分类2：自连接 vs 非自连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-%E5%88%86%E7%B1%BB3%EF%BC%9A%E5%86%85%E8%BF%9E%E6%8E%A5-vs-%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.4.4 分类3：内连接 vs 外连接</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A0-SQL99%EF%BC%9A%E4%BD%BF%E7%94%A8ON%E5%AD%90%E5%8F%A5%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5"><span class="toc-text">① SQL99：使用ON子句创建连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A1-%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">② 左外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E2%91%A2-%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5"><span class="toc-text">③ 右外连接</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9ASQL-JOINS"><span class="toc-text">总结：SQL JOINS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%8D%95%E8%A1%8C%E5%87%BD%E6%95%B0"><span class="toc-text">2.5 单行函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.5.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="toc-text">2.5.2 字符串函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-3-%E6%95%B0%E5%80%BC%E5%87%BD%E6%95%B0"><span class="toc-text">2.5.3 数值函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-4-%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="toc-text">2.5.4 日期函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-5-%E6%B5%81%E7%A8%8B%E5%87%BD%E6%95%B0"><span class="toc-text">2.5.5 流程函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-6-%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0"><span class="toc-text">2.5.6 其他函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0"><span class="toc-text">2.6 分组函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-%E7%BB%84%E5%87%BD%E6%95%B0%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.6.1 组函数介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-AVG%E5%92%8CSUM%E5%87%BD%E6%95%B0"><span class="toc-text">2.6.2 AVG和SUM函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-3-MIN%E5%92%8CMAX%E5%87%BD%E6%95%B0"><span class="toc-text">2.6.3 MIN和MAX函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-4-COUNT%E5%87%BD%E6%95%B0"><span class="toc-text">2.6.4 COUNT函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-5-GROUP-BY"><span class="toc-text">2.6.5 GROUP BY</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-6-HAVING"><span class="toc-text">2.6.6 HAVING</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E5%B0%8F%E7%BB%93"><span class="toc-text">2.7 小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">2.8注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0%EF%BC%9A%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">第3章：子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.1 基本介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%8D%95%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.2 单行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%8D%95%E8%A1%8C%E6%AF%94%E8%BE%83%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">3.2.1 单行比较操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%AD%E7%9A%84-HAVING-%E5%AD%90%E5%8F%A5"><span class="toc-text">3.2.2 子查询中的 HAVING 子句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E5%AD%90%E6%9F%A5%E8%AF%A2%E4%B8%AD%E7%9A%84%E7%A9%BA%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.3 子查询中的空值问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E9%9D%9E%E6%B3%95%E4%BD%BF%E7%94%A8%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.2.4 非法使用子查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%A4%9A%E8%A1%8C%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.2 多行子查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E4%BD%BF%E7%94%A8ANY%E6%88%96ALL%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">3.2.1 使用ANY或ALL操作符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E7%A9%BA%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.2 空值问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%9B%B8%E5%85%B3%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.3  相关子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-EXISTS%E6%93%8D%E4%BD%9C%E7%AC%A6"><span class="toc-text">3.4 EXISTS操作符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E7%9B%B8%E5%85%B3%E6%9B%B4%E6%96%B0"><span class="toc-text">3.5 相关更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-%E7%9B%B8%E5%85%B3%E5%88%A0%E9%99%A4"><span class="toc-text">3.6 相关删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">3.7注意事项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0%EF%BC%9A%E5%88%9B%E5%BB%BA%E5%92%8C%E7%AE%A1%E7%90%86%E8%A1%A8-%E2%80%94DDL"><span class="toc-text">第4章：创建和管理表 —DDL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">4.1 创建和删除数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%A0%87%E8%AF%86%E7%AC%A6%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="toc-text">4.2 标识符命名规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%B8%B8%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">4.3 常用的数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-MySQL%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">4.3.1 MySQL中的数据类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-2-%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%8F%8A%E5%85%B6%E8%8C%83%E5%9B%B4"><span class="toc-text">4.3.2 常用数据类型及其范围</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-text">4.4 创建表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-text">4.4.1 创建方式一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E5%9F%BA%E4%BA%8E%E7%8E%B0%E6%9C%89%E7%9A%84%E8%A1%A8"><span class="toc-text">4.4.2 创建方式二：基于现有的表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%A4%8D%E5%88%B6employees%E8%A1%A8%EF%BC%8C%E4%B8%8D%E5%8C%85%E5%90%AB%E4%BB%BB%E4%BD%95%E6%95%B0%E6%8D%AE"><span class="toc-text">4.2.3  复制employees表，不包含任何数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="toc-text">4.5 修改表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-1-%E8%BF%BD%E5%8A%A0%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-text">4.5.1 追加一个列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-2-%E4%BF%AE%E6%94%B9%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-text">4.5.2 修改一个列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-3-%E9%87%8D%E5%91%BD%E5%90%8D%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-text">4.5.3 重命名一个列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-4-%E5%88%A0%E9%99%A4%E4%B8%80%E4%B8%AA%E5%88%97"><span class="toc-text">4.5.4 删除一个列</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E9%87%8D%E5%91%BD%E5%90%8D%E8%A1%A8"><span class="toc-text">4.6 重命名表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E5%88%A0%E9%99%A4%E8%A1%A8"><span class="toc-text">4.7 删除表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E6%B8%85%E7%A9%BA%E8%A1%A8"><span class="toc-text">4.8 清空表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9%E6%B3%A8%E6%84%8F%E9%A1%B9"><span class="toc-text">4.9注意项</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%8B%E5%8A%A1"><span class="toc-text">第5章：数据库事务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E4%BB%80%E4%B9%88%E6%98%AF%E4%BA%8B%E5%8A%A1"><span class="toc-text">5.1 什么是事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E4%BA%8B%E5%8A%A1"><span class="toc-text">5.2 如何处理事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E4%BA%8B%E5%8A%A1%E7%9A%84ACID%E5%B1%9E%E6%80%A7"><span class="toc-text">5.3 事务的ACID属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">5.4 数据库的隔离级别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B9%8B%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-text">第6章：数据处理之增删改</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-text">6.1 插入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-text">6.2 更新数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-text">6.3 删除数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0%EF%BC%9A%E7%BA%A6%E6%9D%9F-constraint"><span class="toc-text">第7章：约束(constraint)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.1 什么是约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-NOT-NULL%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.2 NOT NULL约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-UNIQUE%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.3 UNIQUE约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1%E6%B3%A8%E6%84%8F%E5%85%B3%E4%BA%8Enull"><span class="toc-text">7.3.1注意关于null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-PRIMARY-KEY-%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.4 PRIMARY KEY 约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-FOREIGN-KEY-%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.5 FOREIGN KEY 约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-CHECK-%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.6 CHECK 约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-7-DEFAULT%E7%BA%A6%E6%9D%9F"><span class="toc-text">7.7 DEFAULT约束</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0%EF%BC%9A%E5%85%B6%E5%AE%83%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-text">第8章：其它数据库对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E8%B1%A1"><span class="toc-text">8.1 常见的数据库对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%A7%86%E5%9B%BE%EF%BC%88VIEW%EF%BC%89"><span class="toc-text">8.2 视图（VIEW）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E7%B4%A2%E5%BC%95%EF%BC%88INDEX%EF%BC%89"><span class="toc-text">8.3 索引（INDEX）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">8.3.1 基本介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-2-%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">8.3.2 索引的介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-3-%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-text">8.3.3 创建索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-4-%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-text">8.3.4 删除索引</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/f0272227.html" title="全栈项目学习中遇到的BUG">全栈项目学习中遇到的BUG</a><time datetime="2024-12-03T06:20:12.000Z" title="发表于 2024-12-03 14:20:12">2024-12-03</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/22971c90.html" title="2.3 线性代数">2.3 线性代数</a><time datetime="2024-11-21T06:16:47.000Z" title="发表于 2024-11-21 14:16:47">2024-11-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3f7516a7.html" title="数据操作+数据预处理">数据操作+数据预处理</a><time datetime="2024-11-20T09:06:49.000Z" title="发表于 2024-11-20 17:06:49">2024-11-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/e04cc1e1.html" title="动手学深度学习中遇到的问题">动手学深度学习中遇到的问题</a><time datetime="2024-11-13T08:57:02.000Z" title="发表于 2024-11-13 16:57:02">2024-11-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3de4876d.html" title="MySQL数据库之索引">MySQL数据库之索引</a><time datetime="2023-08-04T07:23:35.000Z" title="发表于 2023-08-04 15:23:35">2023-08-04</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/HatsuneMiku6.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Yincha</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.whfire.top',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.whfire.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="//at.alicdn.com/t/c/font_4022529_htmrp77uopm.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Hello World,Where there is a will there is a way,Live and Learn" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/01/assets/haru01.model.json"},"display":{"position":"left","width":75,"height":150},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>